import{r as n,j as r,aw as M,B as A,D as y,L as P,T as _}from"./vendor-BN4GkXqm.js";import{B as W}from"./button-D2ShRbt1.js";import{I as k}from"./input-DTDOPjHH.js";import{L as j}from"./label-BHOAk8Im.js";import{C as D,b as F,c as U,d as $,a as B}from"./card-DucpITGF.js";import{s as q,c as E,A as T,t as S,d as z}from"./index-BUF6XHbx.js";import{j as L,k as H}from"./radix-DRLsuDDF.js";const C=q,R=n.forwardRef(({className:s,...m},e)=>r.jsx(L,{ref:e,className:E("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...m,children:r.jsx(H,{className:E("flex items-center justify-center text-current"),children:r.jsx(M,{className:"h-4 w-4"})})}));R.displayName=L.displayName;function V(){const s=n.useContext(T),m=A();if(s===void 0)throw new Error("useAuth must be used within an AuthProvider");const{user:e,session:l,loading:c,error:u,signIn:h,signOut:f,resetPassword:g,updatePassword:x,refreshUser:b,initialized:w}=s,v=n.useMemo(()=>!!e&&!!l,[e,l]),N=n.useMemo(()=>(e==null?void 0:e.role)==="admin",[e]),o=n.useMemo(()=>i=>(e==null?void 0:e.role)===i,[e]),a=n.useMemo(()=>i=>e?i.includes(e.role):!1,[e]),d=n.useMemo(()=>i=>e?i.every(I=>e.role===I):!1,[e]),t=async()=>{try{await f(),S({title:"Signed out",description:"You have been signed out successfully."}),m("/login")}catch(i){console.error("Sign out error:",i),S({title:"Error",description:"Failed to sign out. Please try again.",variant:"destructive"})}},p=i=>{if(!e)return!1;if(e.role==="admin")return!0;switch(i){case"view_dashboard":return["admin","manager","data_collector","viewer"].includes(e.role);case"manage_users":return["admin","manager"].includes(e.role);case"view_reports":return["admin","manager","data_collector","viewer"].includes(e.role);case"create_reports":return["admin","manager","data_collector"].includes(e.role);case"edit_reports":return["admin","manager","data_collector"].includes(e.role);case"delete_reports":return["admin","manager"].includes(e.role);case"view_admin_panel":return["admin","manager"].includes(e.role);case"manage_settings":return["admin"].includes(e.role);default:return!1}};return{user:e,session:l,loading:c,error:u,isAuthenticated:v,isAdmin:N,initialized:w,signIn:h,signOut:t,resetPassword:g,updatePassword:x,refreshUser:b,hasRole:o,hasAnyRole:a,hasAllRoles:d,hasPermission:p,canCreateUserWithRole:i=>e?e.role==="admin"||e.role==="manager"&&i!=="admin":!1,canManageUsers:()=>p("manage_users"),canViewReports:()=>p("view_reports"),canEditReports:()=>p("edit_reports")}}const Y=async(s,m)=>{try{const{data:e}=await C.rpc("get_browser_info"),{data:l}=await C.rpc("get_ip_info"),c=s.includes("@"),u=l&&typeof l=="object"&&l!==null&&"ip"in l?l.ip:null,h=e&&typeof e=="object"&&e!==null&&"user_agent"in e?e.user_agent:null,f={user_identifier:s,email:c?s:null,phone:c?null:s,login_type:c?"email":"phone",status:m,time:new Date().toISOString(),ip:u,browser:h},{error:g}=await C.from("login_logs").insert([f]);g&&console.error("Error logging login attempt:",g)}catch(e){console.error("Error logging login attempt:",e)}};function ee(){const[s,m]=n.useState(""),[e,l]=n.useState(""),[c,u]=n.useState(!1),[h,f]=n.useState(!1),[g,x]=n.useState(null),b=A(),{signIn:w}=V();n.useEffect(()=>(document.title="Wild Elephant Monitoring System - Login",()=>{document.title="Wild Elephant Monitoring System"}),[]),n.useEffect(()=>{(async()=>{try{await z()||console.log("Working in offline mode")}catch{console.log("Connection check error, continuing in offline mode if possible")}})()},[]);const v=o=>{const a=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,d=/^\d{10}$/;return a.test(o)||d.test(o)},N=async o=>{o.preventDefault(),u(!0),x(null);try{if(!v(s)){_.error("Please enter a valid email or phone number"),x("Please enter a valid email or phone number"),u(!1);return}console.log("Starting login process for:",s);const a=!0;console.log("Calling signIn with:",{identifier:s,shouldRemember:a});const{user:d,error:t}=await w(s,e,a);if(console.log("Sign in result:",{user:d,error:t}),t)throw t;if(!d)throw new Error("No user data received after login");try{await Y(s,"success")}catch{console.log("Unable to log login attempt (possibly offline)")}const p="/";console.log("Login successful, redirecting to home page"),b(p,{replace:!0})}catch(a){console.error("Login error:",a);const d=a instanceof Error?a.message:"An unknown error occurred during login",t=a;console.error("Error details:",{error:a,name:t==null?void 0:t.name,code:t==null?void 0:t.code,status:t==null?void 0:t.status,response:t==null?void 0:t.response}),x(d),_.error(d),u(!1)}};return r.jsx("div",{className:"min-h-screen flex flex-col justify-center py-12 bg-gradient-to-b from-[#f8fafc] to-[#e8f1fe]/50 backdrop-blur-sm",children:r.jsxs("div",{className:"sm:mx-auto sm:w-full sm:max-w-md px-4",children:[r.jsxs(y.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},className:"flex flex-col items-center",children:[r.jsx(y.img,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.5,delay:.2},src:"/elephant-watch-app/elephant_photo.png",alt:"Elephant Watch Logo",className:"h-24 w-auto drop-shadow-sm"}),r.jsx(y.p,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.4},className:"text-xl text-gray-600 max-w-2xl mx-auto",children:"Wild Elephant Monitoring System"}),r.jsx(y.p,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.5},className:"text-lg text-gray-500 mt-2",children:"जंगली हाथी निगरानी प्रणाली (2025)"})]}),r.jsx(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.6},className:"max-w-md mx-auto",children:r.jsxs(D,{className:"bg-white shadow-md border-0 rounded-xl overflow-hidden backdrop-blur-sm bg-opacity-95",children:[r.jsxs(F,{className:"space-y-1 pb-3",children:[r.jsx(U,{className:"text-2xl font-light tracking-tight text-primary",children:"Welcome back"}),r.jsx($,{className:"text-gray-600",children:"Enter your email or phone number to access the system"})]}),r.jsx(B,{className:"pt-3",children:r.jsxs("form",{onSubmit:N,className:"space-y-5",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx(j,{htmlFor:"identifier",className:"text-sm font-medium text-gray-700",children:"Email or Phone Number"}),r.jsx(k,{id:"identifier",type:"text",placeholder:"Enter email or 10-digit phone number",value:s,onChange:o=>m(o.target.value),required:!0,className:"rounded-lg border-gray-200 focus:border-primary focus:ring-1 focus:ring-primary shadow-sm",disabled:c}),g&&r.jsx("p",{className:"text-sm text-error mt-1",children:g})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(j,{htmlFor:"password",className:"text-sm font-medium text-gray-700",children:"Password"}),r.jsx(k,{id:"password",type:"password",value:e,onChange:o=>l(o.target.value),required:!0,className:"rounded-lg border-gray-200 focus:border-primary focus:ring-1 focus:ring-primary shadow-sm",disabled:c})]}),r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx(R,{id:"remember",checked:h,onCheckedChange:o=>f(o),disabled:c,className:"border-gray-200 text-primary focus:ring-primary/20"}),r.jsx(j,{htmlFor:"remember",className:"text-sm font-normal text-gray-600 select-none",children:"Remember me"})]}),r.jsx(W,{type:"submit",className:"w-full bg-primary hover:bg-primary/90 text-white rounded-lg py-5 text-base font-medium transition-all duration-200 shadow-sm hover:shadow",disabled:c,children:c?r.jsxs(r.Fragment,{children:[r.jsx(P,{className:"mr-2 h-4 w-4 animate-spin"}),"Signing in..."]}):"Sign in"})]})})]})})]})})}export{ee as default};
//# sourceMappingURL=Login-MjDlGB_D.js.map
