import{r as c,z as E,v as L,j as e,K as m,L as S,A as k}from"./vendor-CnUrRcg9.js";import{a as I,b as _,B as A,d as R}from"./index-CVoE3lMI.js";import{I as b}from"./input-DrIyNNOV.js";import{L as f}from"./label-QLLoIWWi.js";import{C as P,a as D,b as F,d as M,c as W}from"./card-BgkI8bZ8.js";import{C as $}from"./checkbox-CASbmojb.js";import"./radix-Q9zGz_p4.js";const y=I,q=async(a,g)=>{try{const{data:r}=await y.rpc("get_browser_info"),{data:i}=await y.rpc("get_ip_info"),n=a.includes("@"),d=i&&typeof i=="object"&&i!==null&&"ip"in i?i.ip:null,u=r&&typeof r=="object"&&r!==null&&"user_agent"in r?r.user_agent:null,p={user_identifier:a,email:n?a:null,phone:n?null:a,login_type:n?"email":"phone",status:g,time:new Date().toISOString(),ip:d,browser:u},{error:h}=await y.from("login_logs").insert([p]);h&&console.error("Error logging login attempt:",h)}catch(r){console.error("Error logging login attempt:",r)}};function Q(){const[a,g]=c.useState(""),[r,i]=c.useState(""),[n,d]=c.useState(!1),[u,p]=c.useState(!1),[h,x]=c.useState(null),w=E();L();const{signIn:N}=_();c.useEffect(()=>{(async()=>{try{await R()||console.log("Working in offline mode")}catch{console.log("Connection check error, continuing in offline mode if possible")}})()},[]);const j=o=>{const s=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,l=/^\d{10}$/;return s.test(o)||l.test(o)},v=async o=>{o.preventDefault(),d(!0),x(null);try{if(!j(a)){x("Please enter a valid email or phone number"),d(!1);return}console.log("Starting login process for:",a);const s=!0;console.log("Calling signIn with:",{identifier:a,shouldRemember:s});const{user:l,error:t}=await N(a,r,s);if(console.log("Sign in result:",{user:l,error:t}),t)throw t;if(!l)throw new Error("No user data received after login");try{await q(a,"success")}catch{console.log("Unable to log login attempt (possibly offline)")}const C="/";console.log("Login successful, redirecting to home page"),w(C,{replace:!0})}catch(s){console.error("Login error:",s);const l=s instanceof Error?s.message:"An unknown error occurred during login",t=s;console.error("Error details:",{error:s,name:t==null?void 0:t.name,code:t==null?void 0:t.code,status:t==null?void 0:t.status,response:t==null?void 0:t.response}),x(l),k.error(l),d(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-white to-blue-50",children:e.jsxs("div",{className:"container mx-auto py-12 px-4",children:[e.jsxs(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"text-center mb-16",children:[e.jsx("div",{className:"flex items-center justify-center mb-8",children:e.jsx("img",{src:"/elephant_photo.png",alt:"Elephant Logo",className:"w-24 h-24 object-contain"})}),e.jsx(m.h1,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.3},className:"text-6xl font-bold mb-6 bg-gradient-to-r from-blue-600 to-green-600 bg-clip-text text-transparent",children:"Eravat"}),e.jsx(m.p,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.4},className:"text-xl text-gray-600 max-w-2xl mx-auto",children:"Wild Elephant Monitoring System"}),e.jsx(m.p,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.5},className:"text-lg text-gray-500 mt-2",children:"जंगली हाथी निगरानी प्रणाली (2025)"})]}),e.jsx(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.6},className:"max-w-md mx-auto",children:e.jsxs(P,{className:"bg-white shadow-lg border-0 rounded-2xl overflow-hidden",children:[e.jsxs(D,{className:"space-y-1",children:[e.jsx(F,{className:"text-2xl font-bold text-gray-900",children:"Welcome back"}),e.jsx(M,{className:"text-gray-600",children:"Enter your email or phone number to access the system"})]}),e.jsx(W,{children:e.jsxs("form",{onSubmit:v,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"identifier",className:"text-gray-700",children:"Email or Phone Number"}),e.jsx(b,{id:"identifier",type:"text",placeholder:"Enter email or 10-digit phone number",value:a,onChange:o=>g(o.target.value),required:!0,className:"focus:ring-blue-600 border-gray-200",disabled:n})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"password",className:"text-gray-700",children:"Password"}),e.jsx(b,{id:"password",type:"password",value:r,onChange:o=>i(o.target.value),required:!0,className:"focus:ring-blue-600 border-gray-200",disabled:n})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{id:"remember",checked:u,onCheckedChange:o=>p(o),disabled:n,className:"border-gray-200"}),e.jsx(f,{htmlFor:"remember",className:"text-sm font-normal text-gray-600",children:"Remember me"})]}),e.jsx(A,{type:"submit",className:"w-full bg-gradient-to-r from-blue-600 to-green-600 hover:from-blue-700 hover:to-green-700 text-white rounded-xl py-6 text-lg font-semibold transition-all duration-300",disabled:n,children:n?e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"mr-2 h-4 w-4 animate-spin"}),"Logging in..."]}):"Login"})]})})]})})]})})}export{Q as default};
//# sourceMappingURL=Login-4WZ46U6K.js.map
