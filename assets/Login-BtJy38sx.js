import{p as E,r as c,u as L,b as S,x as I,j as e,B as k,L as _,y as P,o as b}from"./index-Ct3NJnDQ.js";import{I as w}from"./input-BO27yAVT.js";import{L as y}from"./label-B4wO6xg1.js";import{C as A,a as F,b as R,d as D,c as M}from"./card-Dql-rexB.js";import{C as $}from"./checkbox-DOOetKR6.js";import{m}from"./proxy-xj7lnTXt.js";import"./index-jP2RKmfx.js";const f=E,q=async(r,u)=>{try{const{data:o}=await f.rpc("get_browser_info"),{data:l}=await f.rpc("get_ip_info"),n=r.includes("@"),d=l&&typeof l=="object"&&l!==null&&"ip"in l?l.ip:null,g=o&&typeof o=="object"&&o!==null&&"user_agent"in o?o.user_agent:null,p={email:n?r:null,phone:n?null:r,login_type:n?"email":"phone",status:u,time:new Date().toISOString(),ip:d,browser:g},{error:h}=await f.from("login_logs").insert([p]);h&&console.error("Error logging login attempt:",h)}catch(o){console.error("Error logging login attempt:",o)}};function K(){const[r,u]=c.useState(""),[o,l]=c.useState(""),[n,d]=c.useState(!1),[g,p]=c.useState(!1),[h,x]=c.useState(null),N=L();S();const{signIn:j}=I();c.useEffect(()=>{(async()=>{await P()||b.error("Failed to connect to Supabase. Please check your configuration.")})()},[]);const v=a=>{const s=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,i=/^\d{10}$/;return s.test(a)||i.test(a)},C=async a=>{a.preventDefault(),d(!0),x(null);try{if(!v(r)){x("Please enter a valid email or phone number"),d(!1);return}console.log("Starting login process for:",r),console.log("Calling signIn with:",{identifier:r});const{user:s,error:i}=await j(r,o,g);if(console.log("Sign in result:",{user:s,error:i}),i)throw i;if(!s)throw new Error("No user data received after login");await q(r,"success");const t="/";console.log("Login successful, redirecting to home page"),N(t,{replace:!0})}catch(s){console.error("Login error:",s);const i=s instanceof Error?s.message:"An unknown error occurred during login",t=s;console.error("Error details:",{error:s,name:t==null?void 0:t.name,code:t==null?void 0:t.code,status:t==null?void 0:t.status,response:t==null?void 0:t.response}),x(i),b.error(i),d(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-white to-blue-50",children:e.jsxs("div",{className:"container mx-auto py-12 px-4",children:[e.jsxs(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"text-center mb-16",children:[e.jsx("div",{className:"flex items-center justify-center mb-8",children:e.jsx("img",{src:"/elephant_photo.png",alt:"Elephant Logo",className:"w-24 h-24 object-contain"})}),e.jsx(m.h1,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.3},className:"text-6xl font-bold mb-6 bg-gradient-to-r from-blue-600 to-green-600 bg-clip-text text-transparent",children:"Eravat"}),e.jsx(m.p,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.4},className:"text-xl text-gray-600 max-w-2xl mx-auto",children:"Wild Elephant Monitoring System"}),e.jsx(m.p,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.5},className:"text-lg text-gray-500 mt-2",children:"जंगली हाथी निगरानी प्रणाली (2025)"})]}),e.jsx(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.6},className:"max-w-md mx-auto",children:e.jsxs(A,{className:"bg-white shadow-lg border-0 rounded-2xl overflow-hidden",children:[e.jsxs(F,{className:"space-y-1",children:[e.jsx(R,{className:"text-2xl font-bold text-gray-900",children:"Welcome back"}),e.jsx(D,{className:"text-gray-600",children:"Enter your email or phone number to access the system"})]}),e.jsx(M,{children:e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"identifier",className:"text-gray-700",children:"Email or Phone Number"}),e.jsx(w,{id:"identifier",type:"text",placeholder:"Enter email or 10-digit phone number",value:r,onChange:a=>u(a.target.value),required:!0,className:"focus:ring-blue-600 border-gray-200",disabled:n})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"password",className:"text-gray-700",children:"Password"}),e.jsx(w,{id:"password",type:"password",value:o,onChange:a=>l(a.target.value),required:!0,className:"focus:ring-blue-600 border-gray-200",disabled:n})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{id:"remember",checked:g,onCheckedChange:a=>p(a),disabled:n,className:"border-gray-200"}),e.jsx(y,{htmlFor:"remember",className:"text-sm font-normal text-gray-600",children:"Remember me"})]}),e.jsx(k,{type:"submit",className:"w-full bg-gradient-to-r from-blue-600 to-green-600 hover:from-blue-700 hover:to-green-700 text-white rounded-xl py-6 text-lg font-semibold transition-all duration-300",disabled:n,children:n?e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"mr-2 h-4 w-4 animate-spin"}),"Logging in..."]}):"Login"})]})})]})})]})})}export{K as default};
