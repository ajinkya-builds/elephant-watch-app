import{c as y,j as e,e as R,q as z,t as B,z as F,A as I,r as n,a as $,p as g,o as u,B as h}from"./index-BN8LcDn3.js";import{I as m}from"./input-BTC4v1fB.js";import{T as H,a as V,b as w,c as o,d as D,e as c}from"./table-DagU9-7h.js";import{C,a as N,b as _,c as k}from"./card-BqoXHyi7.js";/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=y("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=y("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=y("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),K=z("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function U({className:l,variant:t,...d}){return e.jsx("div",{className:R(K({variant:t}),l),...d})}function O({items:l}){return e.jsx("nav",{className:"flex items-center space-x-1 text-sm text-gray-500 mb-6",children:l.map((t,d)=>e.jsxs(B.Fragment,{children:[d>0&&e.jsx(F,{className:"h-4 w-4"}),t.href?e.jsx(I,{to:t.href,className:"hover:text-gray-700 transition-colors",children:t.label}):e.jsx("span",{className:"text-gray-900 font-medium",children:t.label})]},t.label))})}function ee(){const[l,t]=n.useState(""),[d,S]=n.useState([]),[E,j]=n.useState(!1),[L,i]=n.useState(!0),[v,M]=n.useState(null),[r,x]=n.useState({email:"",password:"",first_name:"",last_name:"",role:"data_collector",position:"Ranger"}),{user:p}=$(),f=n.useCallback(async()=>{i(!0);try{const{data:s,error:a}=await g.functions.invoke("get-users",{method:"GET"});if(a)throw a;S(s.users||[])}catch(s){M(s.message||"Failed to load users"),u.error(s.message||"Failed to load users")}finally{i(!1)}},[]);n.useEffect(()=>{f()},[f]);const T=async s=>{s.preventDefault(),i(!0);try{const a={email:r.email,password:r.password,user_metadata:{first_name:r.first_name,last_name:r.last_name,role:r.role,position:r.position}},P={first_name:r.first_name,last_name:r.last_name,email:r.email,role:r.role,position:r.position,status:"active",created_by:p==null?void 0:p.id},{error:b}=await g.functions.invoke("create-user",{body:{userData:a,assignments:P}});if(b)throw b;u.success("User created successfully"),j(!1),f()}catch(a){u.error(`Error creating user: ${a.message}`)}finally{i(!1)}},A=async s=>{if(window.confirm(`Are you sure you want to delete ${s.first_name}?`)){i(!0);try{const{error:a}=await g.functions.invoke("delete-user",{body:{userId:s.id,authId:s.auth_id}});if(a)throw a;u.success("User deleted successfully"),f()}catch(a){u.error(`Error deleting user: ${a.message}`)}finally{i(!1)}}},q=d.filter(s=>`${s.first_name} ${s.last_name}`.toLowerCase().includes(l.toLowerCase())||s.email.toLowerCase().includes(l.toLowerCase()));return L?e.jsx("div",{children:"Loading users..."}):v?e.jsxs("div",{className:"text-red-500",children:["Error: ",v]}):e.jsxs(e.Fragment,{children:[e.jsx(O,{items:[{label:"Admin"},{label:"User Management"}]}),e.jsxs(C,{children:[e.jsxs(N,{children:[e.jsx(_,{children:"User Management"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(m,{placeholder:"Search by name or email",value:l,onChange:s=>t(s.target.value),className:"max-w-sm"}),e.jsxs(h,{onClick:()=>j(!0),children:[e.jsx(Z,{className:"mr-2 h-4 w-4"})," Add User"]})]})]}),e.jsx(k,{children:e.jsxs(H,{children:[e.jsx(V,{children:e.jsxs(w,{children:[e.jsx(o,{children:"Name"}),e.jsx(o,{children:"Email"}),e.jsx(o,{children:"Role"}),e.jsx(o,{children:"Position"}),e.jsx(o,{children:"Status"}),e.jsx(o,{children:"Actions"})]})}),e.jsx(D,{children:q.map(s=>e.jsxs(w,{children:[e.jsxs(c,{children:[s.first_name," ",s.last_name]}),e.jsx(c,{children:s.email}),e.jsx(c,{children:e.jsx(U,{children:s.role})}),e.jsx(c,{children:s.position}),e.jsx(c,{children:e.jsx(U,{variant:s.status==="active"?"default":"destructive",children:s.status})}),e.jsxs(c,{className:"flex gap-2",children:[e.jsx(h,{variant:"outline",size:"icon",disabled:!0,children:e.jsx(G,{className:"h-4 w-4"})}),e.jsx(h,{variant:"destructive",size:"icon",onClick:()=>A(s),children:e.jsx(J,{className:"h-4 w-4"})})]})]},s.id))})]})})]}),E&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:e.jsxs(C,{className:"w-full max-w-md",children:[e.jsx(N,{children:e.jsx(_,{children:"Add New User"})}),e.jsx(k,{children:e.jsxs("form",{onSubmit:T,className:"space-y-4",children:[e.jsx(m,{placeholder:"First Name",onChange:s=>x(a=>({...a,first_name:s.target.value})),required:!0}),e.jsx(m,{placeholder:"Last Name",onChange:s=>x(a=>({...a,last_name:s.target.value})),required:!0}),e.jsx(m,{type:"email",placeholder:"Email",onChange:s=>x(a=>({...a,email:s.target.value})),required:!0}),e.jsx(m,{type:"password",placeholder:"Password",onChange:s=>x(a=>({...a,password:s.target.value})),required:!0}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(h,{type:"button",variant:"outline",onClick:()=>j(!1),children:"Cancel"}),e.jsx(h,{type:"submit",children:"Create User"})]})]})})]})})]})}export{ee as default};
