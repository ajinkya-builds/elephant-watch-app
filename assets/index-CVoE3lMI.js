const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Index-BFNMwdU1.js","assets/vendor-CnUrRcg9.js","assets/vendor-Dgihpmma.css","assets/card-BgkI8bZ8.js","assets/radix-Q9zGz_p4.js","assets/NotFound-z1ctJDKU.js","assets/ReportActivityPage-B8ifQnp8.js","assets/input-DrIyNNOV.js","assets/label-QLLoIWWi.js","assets/select-Dpm1cjej.js","assets/Dashboard-C3rbX_7p.js","assets/Admin-_JzEYALo.js","assets/Login-4WZ46U6K.js","assets/checkbox-CASbmojb.js","assets/AdminUsers-B88ZY8q-.js","assets/table-D1iBvv0q.js","assets/AdminObservations-DkYSWAl7.js","assets/AdminStatistics-BfAAyQDP.js","assets/AdminSettings-DS4HxaWP.js","assets/switch-DrZ4mG_H.js","assets/AdminNotifications-BLAtIi3N.js"])))=>i.map(i=>d[i]);
import{r as a,t as dt,m as ut,j as e,n as Ne,X as pe,p as mt,$ as ft,q as gt,C as Ee,G as he,L as pt,P as S,v as ht,N as xt,O as Pe,w as wt,x as yt,y as vt,z as xe,B as _t,A as Z,D as te,M as bt,W as St,E as jt,_ as D,Q as Nt,F as Et,H as Pt,I as Ot,J as At}from"./vendor-CnUrRcg9.js";import{V as Oe,R as Ae,A as Ie,C as ke,T as Ce,D as De,P as It,a as Re,b as kt,S as Ct,c as Te,d as ze,e as Dt,f as Ue,I as Le,g as Me,h as Ve,i as Fe,L as Je,j as $e,k as Rt,l as Tt,O as Be,m as zt,n as qe,o as Ut,p as Ge,q as We,r as Lt}from"./radix-Q9zGz_p4.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))n(u);new MutationObserver(u=>{for(const f of u)if(f.type==="childList")for(const j of f.addedNodes)j.tagName==="LINK"&&j.rel==="modulepreload"&&n(j)}).observe(document,{childList:!0,subtree:!0});function s(u){const f={};return u.integrity&&(f.integrity=u.integrity),u.referrerPolicy&&(f.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?f.credentials="include":u.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function n(u){if(u.ep)return;u.ep=!0;const f=s(u);fetch(u.href,f)}})();const Mt=1,Vt=1e6;let le=0;function Ft(){return le=(le+1)%Number.MAX_SAFE_INTEGER,le.toString()}const ce=new Map,Se=t=>{if(ce.has(t))return;const r=setTimeout(()=>{ce.delete(t),re({type:"REMOVE_TOAST",toastId:t})},Vt);ce.set(t,r)},Jt=(t,r)=>{switch(r.type){case"ADD_TOAST":return{...t,toasts:[r.toast,...t.toasts].slice(0,Mt)};case"UPDATE_TOAST":return{...t,toasts:t.toasts.map(s=>s.id===r.toast.id?{...s,...r.toast}:s)};case"DISMISS_TOAST":{const{toastId:s}=r;return s?Se(s):t.toasts.forEach(n=>{Se(n.id)}),{...t,toasts:t.toasts.map(n=>n.id===s||s===void 0?{...n,open:!1}:n)}}case"REMOVE_TOAST":return r.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(s=>s.id!==r.toastId)}}},oe=[];let ne={toasts:[]};function re(t){ne=Jt(ne,t),oe.forEach(r=>{r(ne)})}function de({...t}){const r=Ft(),s=u=>re({type:"UPDATE_TOAST",toast:{...u,id:r}}),n=()=>re({type:"DISMISS_TOAST",toastId:r});return re({type:"ADD_TOAST",toast:{...t,id:r,open:!0,onOpenChange:u=>{u||n()}}}),{id:r,dismiss:n,update:s}}function $t(){const[t,r]=a.useState(ne);return a.useEffect(()=>(oe.push(r),()=>{const s=oe.indexOf(r);s>-1&&oe.splice(s,1)}),[t]),{...t,toast:de,dismiss:s=>re({type:"DISMISS_TOAST",toastId:s})}}function v(...t){return dt(ut(t))}const Bt=It,He=a.forwardRef(({className:t,...r},s)=>e.jsx(Oe,{ref:s,className:v("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",t),...r}));He.displayName=Oe.displayName;const qt=Ne("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),Ye=a.forwardRef(({className:t,variant:r,...s},n)=>e.jsx(Ae,{ref:n,className:v(qt({variant:r}),t),...s}));Ye.displayName=Ae.displayName;const Gt=a.forwardRef(({className:t,...r},s)=>e.jsx(Ie,{ref:s,className:v("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",t),...r}));Gt.displayName=Ie.displayName;const Ke=a.forwardRef(({className:t,...r},s)=>e.jsx(ke,{ref:s,className:v("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",t),"toast-close":"",...r,children:e.jsx(pe,{className:"h-4 w-4"})}));Ke.displayName=ke.displayName;const Xe=a.forwardRef(({className:t,...r},s)=>e.jsx(Ce,{ref:s,className:v("text-sm font-semibold",t),...r}));Xe.displayName=Ce.displayName;const Ze=a.forwardRef(({className:t,...r},s)=>e.jsx(De,{ref:s,className:v("text-sm opacity-90",t),...r}));Ze.displayName=De.displayName;function Wt(){const{toasts:t}=$t();return e.jsxs(Bt,{children:[t.map(function({id:r,title:s,description:n,action:u,...f}){return e.jsxs(Ye,{...f,children:[e.jsxs("div",{className:"grid gap-1",children:[s&&e.jsx(Xe,{children:s}),n&&e.jsx(Ze,{children:n})]}),u,e.jsx(Ke,{})]},r)}),e.jsx(He,{})]})}const Ht=({...t})=>{const{theme:r="system"}=mt();return e.jsx(ft,{theme:r,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...t})},Yt=kt,Kt=a.forwardRef(({className:t,sideOffset:r=4,...s},n)=>e.jsx(Re,{ref:n,sideOffset:r,className:v("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...s}));Kt.displayName=Re.displayName;const ue="https://vfsyjvjghftfebvxyjba.supabase.co".trim(),me="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZmc3lqdmpnaGZ0ZmVidnh5amJhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkwNTU3MjYsImV4cCI6MjA2NDYzMTcyNn0.td6SnbD51RuNG_tTuKSC7Jwcz_lUk1tcrcNTwC3OLxc".trim(),fe="sb-vfsyjvjghftfebvxyjba-auth-token";if(!ue||!ue.startsWith("https://"))throw new Error("Invalid VITE_SUPABASE_URL format");if(!me||!me.startsWith("eyJ"))throw new Error("Invalid VITE_SUPABASE_ANON_KEY format");let se=null;const Xt={getItem:t=>{try{return localStorage.getItem(t)}catch(r){return console.error(`Error getting item ${t} from storage:`,r),null}},setItem:(t,r)=>{try{localStorage.setItem(t,r)}catch(s){console.error(`Error setting item ${t} in storage:`,s)}},removeItem:t=>{try{localStorage.removeItem(t)}catch(r){console.error(`Error removing item ${t} from storage:`,r)}}},Qe=()=>{if(se)return se;try{return se=gt(ue,me,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,storage:Xt,storageKey:fe,flowType:"pkce",debug:!1}}),se.auth.getSession().then(({data:t,error:r})=>{r?console.error("Error testing Supabase connection:",r):console.log("Supabase connection test successful:",{hasSession:!!t.session,timestamp:new Date().toISOString()})}),se}catch(t){throw console.error("Error creating Supabase client:",t),t}},P=Qe(),Ms=async()=>{try{console.log("Checking Supabase connection (offline operation will still work)...");let t=!1;try{t=!!localStorage.getItem(fe)}catch(f){console.warn("Error checking local storage for session:",f)}const r=new Promise((f,j)=>{setTimeout(()=>j(new Error("Connection check timed out")),3e3)}),s=P.from("users").select("id").limit(1),{error:n}=await Promise.race([s,r]);if(!n)return console.log("Supabase connection successful"),!0;const u=n==null?void 0:n.status;return u===401||u===403?(console.warn("Supabase reachable but access denied (expected for unauthenticated request)."),!0):t?(console.log("Supabase connection failed, but local session exists. App will work offline."),!0):(console.error("Supabase connection error:",n),!1)}catch(t){try{if(localStorage.getItem(fe))return console.log("Supabase connection check failed, but local session exists. Will work offline."),!0}catch(r){console.warn("Error checking local storage for session:",r)}return console.error("Supabase connection error:",t),!1}},et=()=>{const[t,r]=a.useState(navigator.onLine);return a.useEffect(()=>{const s=()=>r(!0),n=()=>r(!1);return window.addEventListener("online",s),window.addEventListener("offline",n),()=>{window.removeEventListener("online",s),window.removeEventListener("offline",n)}},[]),{isOnline:t}},tt=async()=>{if(console.log("Requesting location permission"),!Ee.isNativePlatform())return console.warn("Geolocation is not available on web platform. Returning default denied status."),{location:"denied",coarseLocation:"denied"};try{const t=await he.requestPermissions();return console.log("Location permission status:",t),t}catch(t){throw console.error("Error requesting location permission:",t),t}},Zt=async()=>{try{return(await he.checkPermissions()).location==="granted"}catch(t){return console.error("Error checking location permissions:",t),!1}},Qt=async()=>{if(!Ee.isNativePlatform())return console.warn("Geolocation is not available on web platform. Returning default location."),{latitude:0,longitude:0,accuracy:0,timestamp:Date.now()};try{if(!await Zt()&&(await tt()).location!=="granted")throw new Error("Location permission denied");const r=await he.getCurrentPosition({enableHighAccuracy:!0,timeout:1e4,maximumAge:0});return{latitude:r.coords.latitude,longitude:r.coords.longitude,accuracy:r.coords.accuracy,timestamp:r.timestamp}}catch(t){throw console.error("Error getting current position:",t),t}},I=({message:t="Loading..."})=>e.jsx("div",{className:"fixed inset-0 z-50 flex flex-col items-center justify-center bg-background/80 backdrop-blur-sm",children:e.jsxs("div",{className:"text-center",children:[e.jsx(pt,{className:"mx-auto mb-4 h-12 w-12 animate-spin text-primary"}),e.jsx("p",{className:"text-lg font-semibold text-foreground",children:t}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Please wait a moment."})]})}),X="sb-vfsyjvjghftfebvxyjba-auth-token",je=30*24*60*60*1e3,st={user:null,session:null,loading:!0,error:null,initialized:!1},we=a.createContext({...st,signIn:async()=>({user:null,error:new Error("AuthContext not initialized")}),signOut:async()=>({error:new Error("AuthContext not initialized")}),refreshUser:async()=>{},resetPassword:async()=>({error:new Error("AuthContext not initialized")}),updatePassword:async()=>({error:new Error("AuthContext not initialized")}),canCreateUserWithRole:()=>!1,canManageUsers:()=>!1,canViewReports:()=>!1,canEditReports:()=>!1,hasPermission:()=>!1,setNavigation:()=>{},navigate:()=>console.warn("Navigation not initialized"),isAdmin:!1,initialized:!1}),es=({children:t})=>{const[r,s]=a.useState(st),[n,u]=a.useState(()=>c=>{console.warn("Navigation not yet initialized. Attempted to navigate to:",c)}),{isOnline:f}=et(),j=async(c,o,m)=>{const l=new Promise((A,i)=>{const d=setTimeout(()=>{clearTimeout(d),i(new Error(`Timeout after ${o}ms: ${m}`))},o)});return Promise.race([c,l])},O=a.useCallback(async c=>{var A,i,d;console.log("Checking Supabase connection (will continue offline if unavailable)...",c),console.log("fetchUserProfile: Checking for cached user data first..."),console.log("fetchUserProfile: Calling supabase.auth.getUser()...");let o=null,m=null;try{let g;try{g=await j(P.auth.getUser(),1e4,"supabase.auth.getUser() call timed out")}catch(b){throw console.error("fetchUserProfile: Timeout error:",b),new Error("Could not get authentication data: network request timed out")}const{data:{user:w},error:E}=g;if(o=w,console.log("fetchUserProfile: supabase.auth.getUser() completed. User error:",E,"User exists:",!!o),console.log("DEBUG: supabaseUser object:",o),E)throw console.error("fetchUserProfile: Error from supabase.auth.getUser():",E),E;if(!o)throw console.warn("fetchUserProfile: No user returned from supabase.auth.getUser()."),new Error("No user returned from Supabase auth.");let C;try{C=await j((async()=>{if(!o)throw new Error("Cannot fetch profile: user is null");return await P.from("users").select("id, first_name, last_name, email, phone, role, position").eq("auth_id",o.id).single()})(),1e4,"Profile fetch from Supabase timed out")}catch(b){throw console.error("fetchUserProfile: Profile fetch timeout:",b),new Error("Could not get profile data: network request timed out")}const{data:x,error:h}=C;if(m=x,console.log("DEBUG: Profile data from 'profiles' table:",m),console.log("DEBUG: Profile fetch error:",h),console.log("DEBUG: Role from profileData:",m==null?void 0:m.role),h)throw console.error("fetchUserProfile: Error fetching profile from 'profiles' table:",h),h;if(!m)throw console.warn("fetchUserProfile: No profile data found for user:",o.id),new Error("No profile data found.")}catch(g){throw console.error("fetchUserProfile: An unexpected error occurred during user profile fetch:",g),g}const l={id:o.id,auth_id:o.id,first_name:(m==null?void 0:m.first_name)||"",last_name:(m==null?void 0:m.last_name)||"",email:o.email||null,phone:o.phone||null,role:(m==null?void 0:m.role)||"viewer",position:((A=o.user_metadata)==null?void 0:A.position)||"field_agent",status:((i=o.user_metadata)==null?void 0:i.status)||"active",created_at:o.created_at||new Date().toISOString(),updated_at:o.updated_at||new Date().toISOString(),last_login_at:o.last_sign_in_at||null,avatar_url:"",metadata:o.user_metadata||{},permissions:((d=o.user_metadata)==null?void 0:d.permissions)||[],cached_at:new Date().toISOString()};return console.log("DEBUG: Final extendedUser object before return:",l),console.log("DEBUG: Role in final extendedUser object:",l.role),l},[]);a.useEffect(()=>{let c=!0;console.log("AuthProvider: Running initialization effect."),(async m=>{var i,d,g,w,E,C,x,h,b,p,R,L,_,M;console.log("AuthProvider: Starting initializeAuth.");let l=null,A=null;try{console.log("AuthProvider: Attempting to load session from preferences...");const{value:T}=await S.get({key:X});if(console.log("AuthProvider: Preferences.get completed. Stored session exists:",!!T),T)try{const y=JSON.parse(T),z=y.created_at||y.expires_at,_e=new Date(z).getTime();if(new Date().getTime()-_e<je)if(!m)l=y,console.log("AuthProvider: Offline mode - using stored session without validation.");else try{await P.auth.setSession(y),l=y,console.log("AuthProvider: Session restored and validated with Supabase.")}catch{console.log("AuthProvider: Online validation failed, but session is within 30 days. Keeping session."),l=y}else console.log("AuthProvider: Stored session expired (older than 30 days). Clearing."),await S.remove({key:X})}catch(y){console.error("AuthProvider: Failed to parse stored session.",y),await S.remove({key:X}),console.log("AuthProvider: Invalid session format. Clearing.")}if(!l&&m){console.log("AuthProvider: No session from preferences, attempting to get from Supabase...");try{const{data:{session:y}}=await P.auth.getSession();console.log("AuthProvider: supabase.auth.getSession completed. Session exists:",!!y),l=y,console.log("AuthProvider: Fetched session from Supabase.")}catch{console.warn("AuthProvider: Failed to get session from Supabase (possibly network issue):")}}if(l!=null&&l.user)if(console.log("AuthProvider: Session user found, attempting to fetch user profile."),m)try{A=await O(l.user.id),console.log("AuthProvider: fetchUserProfile completed.")}catch(y){console.warn("AuthProvider: Failed to fetch user profile during initialization (possibly offline or error).",y),A={id:l.user.id,auth_id:l.user.id,first_name:((i=l.user.user_metadata)==null?void 0:i.first_name)||"",last_name:((d=l.user.user_metadata)==null?void 0:d.last_name)||"",email:l.user.email||null,phone:l.user.phone||null,role:((g=l.user.user_metadata)==null?void 0:g.role)||"viewer",position:((w=l.user.user_metadata)==null?void 0:w.position)||"field_agent",status:((E=l.user.user_metadata)==null?void 0:E.status)||"active",created_at:l.user.created_at||new Date().toISOString(),updated_at:l.user.updated_at||new Date().toISOString(),last_login_at:l.user.last_sign_in_at||new Date().toISOString(),avatar_url:((C=l.user.user_metadata)==null?void 0:C.avatar_url)||"",metadata:l.user.user_metadata||{},permissions:((x=l.user.user_metadata)==null?void 0:x.permissions)||[]}}else{A={id:l.user.id,auth_id:l.user.id,first_name:((h=l.user.user_metadata)==null?void 0:h.first_name)||"",last_name:((b=l.user.user_metadata)==null?void 0:b.last_name)||"",email:l.user.email||null,phone:l.user.phone||null,role:((p=l.user.user_metadata)==null?void 0:p.role)||"viewer",position:((R=l.user.user_metadata)==null?void 0:R.position)||"field_agent",status:((L=l.user.user_metadata)==null?void 0:L.status)||"active",created_at:l.user.created_at||new Date().toISOString(),updated_at:l.user.updated_at||new Date().toISOString(),last_login_at:l.user.last_sign_in_at||new Date().toISOString(),avatar_url:((_=l.user.user_metadata)==null?void 0:_.avatar_url)||"",metadata:l.user.user_metadata||{},permissions:((M=l.user.user_metadata)==null?void 0:M.permissions)||[],cached_at:new Date().toISOString()};try{const{value:y}=await S.get({key:`user_profile_${l.user.id}`});if(y){const z=JSON.parse(y);z.avatar_url&&!A.avatar_url&&(A.avatar_url=z.avatar_url)}}catch(y){console.warn("AuthProvider: Error retrieving cached profile:",y)}console.log("AuthProvider: Offline, using session user for profile.")}}catch(T){console.error("AuthProvider: Error during main initialization process:",T)}finally{console.log("AuthProvider: initializeAuth finally block reached. isMounted:",c),s(T=>({...T,user:A,session:l,error:null,loading:!1,initialized:!0}))}})(f)},[f,O]);const V=a.useCallback(async(c,o,m=!0)=>{var A,i,d,g,w,E,C;console.log("handleSignIn: Attempting to sign in user:",c),s(x=>({...x,loading:!0,error:null}));const l={email:c,timestamp:new Date().toISOString(),success:!1,online:f,deviceInfo:{userAgent:navigator.userAgent,platform:navigator.platform,screenSize:`${window.screen.width}x${window.screen.height}`}};try{await tt();try{const x=await Qt();l.location=x;try{const{value:h}=await S.get({key:"login_history"});let b=h?JSON.parse(h):[];if(b.length>0){const p=b.length-1;b[p].email===c&&(b[p].location=l.location,await S.set({key:"login_history",value:JSON.stringify(b)}),console.log("Location data added to login history"))}}catch(h){console.warn("Failed to update location in login history:",h)}}catch(x){console.warn("Error getting location:",x)}}catch(x){console.warn("Location permission error:",x)}try{if(window.DeviceOrientationEvent){const x=h=>{window.removeEventListener("deviceorientation",x),h.alpha!==null&&(l.orientation={alpha:h.alpha,beta:h.beta,gamma:h.gamma},S.get({key:"login_history"}).then(({value:b})=>{let p=b?JSON.parse(b):[];if(p.length>0){const R=p.length-1;p[R].email===c&&(p[R].orientation=l.orientation,S.set({key:"login_history",value:JSON.stringify(p)}),console.log("Orientation data added to login history"))}}).catch(b=>{console.warn("Failed to update orientation in login history:",b)}))};window.addEventListener("deviceorientation",x,!0)}}catch(x){console.warn("Error accessing device sensors:",x)}try{const{value:x}=await S.get({key:"login_history"}),h=x?JSON.parse(x):[];if(h.push(l),await S.set({key:"login_history",value:JSON.stringify(h)}),!f){console.log("handleSignIn: Offline mode, checking cached session");try{const{value:_}=await S.get({key:X});if(_){const M=JSON.parse(_),{value:T}=await S.get({key:`user_profile_${M.user.id}`});if(T){const z=JSON.parse(T);if(z.email===c)return console.log("handleSignIn: Offline login successful with cached credentials"),h[h.length-1].success=!0,await S.set({key:"login_history",value:JSON.stringify(h)}),s(be=>({...be,user:z,session:M,loading:!1,error:null})),{user:z,error:null}}const y=new Error("Offline login failed. Please ensure you've logged in at least once with internet connection.");return s(z=>({...z,loading:!1,error:y.message})),{user:null,error:y}}}catch(_){return console.error("handleSignIn: Error during offline login:",_),s(M=>({...M,loading:!1,error:"Offline login failed. No cached session available."})),{user:null,error:_ instanceof Error?_:new Error("Offline login failed")}}}console.log("handleSignIn: Online mode, calling Supabase auth");const b=await j(P.auth.signInWithPassword({email:c,password:o}),15e3,"Supabase auth login request timed out"),{data:p,error:R}=b;if(R)return console.error("handleSignIn: Error signing in with Supabase:",R),s(_=>({..._,loading:!1,error:R.message})),{user:null,error:R};if(!p.user||!p.session){const _=new Error("No user or session returned from Supabase auth");return console.error("handleSignIn: No user returned in auth response"),s(M=>({...M,loading:!1,error:_.message})),{user:null,error:_}}if(console.log("handleSignIn: Supabase auth successful, getting full user profile"),h[h.length-1].success=!0,await S.set({key:"login_history",value:JSON.stringify(h)}),m){const _={...p.session,created_at:new Date().toISOString(),local_expiry:new Date(Date.now()+je).toISOString()};await S.set({key:X,value:JSON.stringify(_)}),console.log("handleSignIn: Session stored with 30-day local expiration date:",_.local_expiry)}let L;try{L=await O(p.user.id),await S.set({key:`user_profile_${p.user.id}`,value:JSON.stringify({...L,cached_at:new Date().toISOString()})}),console.log("handleSignIn: User profile fetched and cached successfully")}catch(_){console.warn("handleSignIn: Error fetching full profile, using basic user data",_),L={id:p.user.id,auth_id:p.user.id,first_name:((A=p.user.user_metadata)==null?void 0:A.first_name)||"",last_name:((i=p.user.user_metadata)==null?void 0:i.last_name)||"",email:p.user.email||null,phone:p.user.phone||null,role:((d=p.user.user_metadata)==null?void 0:d.role)||"viewer",position:((g=p.user.user_metadata)==null?void 0:g.position)||"field_agent",status:((w=p.user.user_metadata)==null?void 0:w.status)||"active",created_at:p.user.created_at||new Date().toISOString(),updated_at:p.user.updated_at||new Date().toISOString(),last_login_at:p.user.last_sign_in_at||new Date().toISOString(),avatar_url:((E=p.user.user_metadata)==null?void 0:E.avatar_url)||"",metadata:p.user.user_metadata||{},permissions:((C=p.user.user_metadata)==null?void 0:C.permissions)||[],cached_at:new Date().toISOString()},await S.set({key:`user_profile_${p.user.id}`,value:JSON.stringify(L)})}return s(_=>({..._,user:L,session:p.session,loading:!1,error:null})),{user:L,error:null}}catch(x){return console.error("handleSignIn: Unexpected error during sign in:",x),s(h=>({...h,loading:!1,error:x instanceof Error?x.message:"An unexpected error occurred"})),{user:null,error:x instanceof Error?x:new Error("Unknown error during sign in")}}},[s,f,O]),$=a.useCallback(async()=>{var c;console.log("handleSignOut: Signing out user"),s(o=>({...o,loading:!0,error:null}));try{const{value:o}=await S.get({key:"login_history"}),m=o?JSON.parse(o):[];if(m.push({timestamp:new Date().toISOString(),event:"signout",online:f,userId:((c=r.user)==null?void 0:c.id)||null}),await S.set({key:"login_history",value:JSON.stringify(m)}),f){const{error:l}=await P.auth.signOut();if(l)throw l}return await S.remove({key:X}),s({user:null,session:null,loading:!1,error:null,initialized:!0}),{error:null}}catch(o){return console.error("Error signing out:",o),s(m=>({...m,loading:!1,error:o instanceof Error?o.message:"Error signing out"})),{error:o instanceof Error?o:new Error("Error signing out")}}},[s,f,r.user]),B=a.useCallback(async c=>{console.log("handleResetPassword: Requesting password reset for:",c),s(o=>({...o,loading:!0,error:null}));try{if(!f)throw new Error("Cannot reset password while offline");const{error:o}=await P.auth.resetPasswordForEmail(c,{redirectTo:window.location.origin+"/reset-password"});if(o)throw o;return s(m=>({...m,loading:!1})),{error:null}}catch(o){return console.error("Error resetting password:",o),s(m=>({...m,loading:!1,error:o instanceof Error?o.message:"Error resetting password"})),{error:o instanceof Error?o:new Error("Error resetting password")}}},[s,f]),G=a.useCallback(async c=>{console.log("handleUpdatePassword: Updating password"),s(o=>({...o,loading:!0,error:null}));try{if(!f)throw new Error("Cannot update password while offline");const{error:o}=await P.auth.updateUser({password:c});if(o)throw o;return s(m=>({...m,loading:!1})),{error:null}}catch(o){return console.error("Error updating password:",o),s(m=>({...m,loading:!1,error:o instanceof Error?o.message:"Error updating password"})),{error:o instanceof Error?o:new Error("Error updating password")}}},[s,f]),q=a.useCallback(c=>{u(()=>c)},[]),W=a.useCallback(async()=>{try{const{data:{user:c},error:o}=await P.auth.getUser();if(o)throw o;if(!c)return;const m=await O(c.id);m&&s(l=>({...l,user:m}))}catch(c){throw console.error("Error refreshing user:",c),c}},[s,O]),U=a.useMemo(()=>{var c;return((c=r.user)==null?void 0:c.role)==="admin"},[r.user]),H=a.useMemo(()=>{var c;return((c=r.user)==null?void 0:c.role)==="manager"},[r.user]),Y=a.useMemo(()=>{var c;return((c=r.user)==null?void 0:c.role)==="data_collector"},[r.user]),K=a.useCallback(c=>{if(!r.user)return!1;switch(r.user.role){case"admin":return!0;case"manager":return["data_collector","viewer"].includes(c);default:return!1}},[r.user]),k=a.useCallback(()=>U||H,[U,H]),N=a.useCallback(()=>!!r.user,[r.user]),F=a.useCallback(()=>U||Y,[U,Y]),ee=a.useCallback(c=>{if(!r.user)return!1;switch(c){case"manage_users":return k();case"view_reports":return N();case"edit_reports":return F();default:return!1}},[r.user,k,N,F]),ae=a.useMemo(()=>{var c;return{...r,signIn:V,signOut:$,refreshUser:W,resetPassword:B,updatePassword:G,canCreateUserWithRole:K,canManageUsers:k,canViewReports:N,canEditReports:F,hasPermission:ee,setNavigation:q,navigate:o=>{n?n(o):console.warn("Navigation not initialized")},isAdmin:((c=r.user)==null?void 0:c.role)==="admin",initialized:r.initialized}},[r,V,$,W,B,G,K,k,N,F,ee,n,q]);return r.initialized?e.jsx(we.Provider,{value:ae,children:t}):e.jsx(I,{message:"Initializing authentication..."})},ye=()=>{const t=a.useContext(we);if(!t)throw new Error("useAuth must be used within an AuthProvider");return t};function ts(){return e.jsx("footer",{className:"bg-gradient-to-r from-blue-600 to-green-600 text-white py-4 mt-8",children:e.jsx("div",{className:"container mx-auto px-2 sm:px-4 text-center",children:e.jsxs("p",{className:"text-xs sm:text-sm font-medium",children:["© ",new Date().getFullYear()," Eravat - Advanced Elephant Monitoring & Conservation Platform"]})})})}const ss=()=>{const{user:t,initialized:r}=ye(),s=ht();return r?t?e.jsx(Pe,{}):e.jsx(xt,{to:"/login",state:{from:s},replace:!0}):e.jsx(I,{message:"Initializing session..."})},rs=Ne("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),ie=a.forwardRef(({className:t,variant:r,size:s,asChild:n=!1,...u},f)=>{const j=n?Ct:"button";return e.jsx(j,{className:v(rs({variant:r,size:s,className:t})),ref:f,...u})});ie.displayName="Button";const rt=Rt,at=Tt,as=a.forwardRef(({className:t,inset:r,children:s,...n},u)=>e.jsxs(Te,{ref:u,className:v("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",r&&"pl-8",t),...n,children:[s,e.jsx(wt,{className:"ml-auto h-4 w-4"})]}));as.displayName=Te.displayName;const os=a.forwardRef(({className:t,...r},s)=>e.jsx(ze,{ref:s,className:v("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...r}));os.displayName=ze.displayName;const ve=a.forwardRef(({className:t,sideOffset:r=4,...s},n)=>e.jsx(Dt,{children:e.jsx(Ue,{ref:n,sideOffset:r,className:v("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...s})}));ve.displayName=Ue.displayName;const J=a.forwardRef(({className:t,inset:r,...s},n)=>e.jsx(Le,{ref:n,className:v("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r&&"pl-8",t),...s}));J.displayName=Le.displayName;const ns=a.forwardRef(({className:t,children:r,checked:s,...n},u)=>e.jsxs(Me,{ref:u,className:v("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),checked:s,...n,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Ve,{children:e.jsx(yt,{className:"h-4 w-4"})})}),r]}));ns.displayName=Me.displayName;const is=a.forwardRef(({className:t,children:r,...s},n)=>e.jsxs(Fe,{ref:n,className:v("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...s,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Ve,{children:e.jsx(vt,{className:"h-2 w-2 fill-current"})})}),r]}));is.displayName=Fe.displayName;const ot=a.forwardRef(({className:t,inset:r,...s},n)=>e.jsx(Je,{ref:n,className:v("px-2 py-1.5 text-sm font-semibold",r&&"pl-8",t),...s}));ot.displayName=Je.displayName;const ge=a.forwardRef(({className:t,...r},s)=>e.jsx($e,{ref:s,className:v("-mx-1 my-1 h-px bg-muted",t),...r}));ge.displayName=$e.displayName;function ls(){const t=a.useContext(we),r=xe();if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");const{user:s,session:n,loading:u,error:f,signIn:j,signOut:O,resetPassword:V,updatePassword:$,refreshUser:B,initialized:G}=t,q=a.useMemo(()=>!!s&&!!n,[s,n]),W=a.useMemo(()=>(s==null?void 0:s.role)==="admin",[s]),U=a.useMemo(()=>N=>(s==null?void 0:s.role)===N,[s]),H=a.useMemo(()=>N=>s?N.includes(s.role):!1,[s]),Y=a.useMemo(()=>N=>s?N.every(F=>s.role===F):!1,[s]),K=async()=>{try{await O(),de({title:"Signed out",description:"You have been signed out successfully."}),r("/login")}catch(N){console.error("Sign out error:",N),de({title:"Error",description:"Failed to sign out. Please try again.",variant:"destructive"})}},k=N=>{if(!s)return!1;if(s.role==="admin")return!0;switch(N){case"view_dashboard":return["admin","manager","data_collector","viewer"].includes(s.role);case"manage_users":return["admin","manager"].includes(s.role);case"view_reports":return["admin","manager","data_collector","viewer"].includes(s.role);case"create_reports":return["admin","manager","data_collector"].includes(s.role);case"edit_reports":return["admin","manager","data_collector"].includes(s.role);case"delete_reports":return["admin","manager"].includes(s.role);case"view_admin_panel":return["admin","manager"].includes(s.role);case"manage_settings":return["admin"].includes(s.role);default:return!1}};return{user:s,session:n,loading:u,error:f,isAuthenticated:q,isAdmin:W,initialized:G,signIn:j,signOut:K,resetPassword:V,updatePassword:$,refreshUser:B,hasRole:U,hasAnyRole:H,hasAllRoles:Y,hasPermission:k,canCreateUserWithRole:N=>s?s.role==="admin"||s.role==="manager"&&N!=="admin":!1,canManageUsers:()=>k("manage_users"),canViewReports:()=>k("view_reports"),canEditReports:()=>k("edit_reports")}}const cs=Lt,ds=zt,nt=a.forwardRef(({className:t,...r},s)=>e.jsx(Be,{ref:s,className:v("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...r}));nt.displayName=Be.displayName;const it=a.forwardRef(({className:t,children:r,...s},n)=>e.jsxs(ds,{children:[e.jsx(nt,{}),e.jsxs(qe,{ref:n,className:v("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...s,children:[r,e.jsxs(Ut,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(pe,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));it.displayName=qe.displayName;const lt=({className:t,...r})=>e.jsx("div",{className:v("flex flex-col space-y-1.5 text-center sm:text-left",t),...r});lt.displayName="DialogHeader";const us=({className:t,...r})=>e.jsx("div",{className:v("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...r});us.displayName="DialogFooter";const ct=a.forwardRef(({className:t,...r},s)=>e.jsx(Ge,{ref:s,className:v("text-lg font-semibold leading-none tracking-tight",t),...r}));ct.displayName=Ge.displayName;const ms=a.forwardRef(({className:t,...r},s)=>e.jsx(We,{ref:s,className:v("text-sm text-muted-foreground",t),...r}));ms.displayName=We.displayName;const fs=Qe();class Q{constructor(){}static getInstance(){return Q.instance||(Q.instance=new Q),Q.instance}async getById(r){const{data:s,error:n}=await fs.from("activity_reports").select("*").eq("id",r).single();if(n)throw n;return s}}function gs(){const{user:t}=ye(),[r,s]=a.useState([]),[n,u]=a.useState(0),[f,j]=a.useState(!0),[O,V]=a.useState(null),[$,B]=a.useState(null),[G,q]=a.useState(!1),[W,U]=a.useState(!1),[H,Y]=a.useState([]),[K,k]=a.useState([]),[N,F]=a.useState([]);a.useEffect(()=>{async function i(){const[d,g,w]=await Promise.all([P.from("divisions").select("id, name"),P.from("ranges").select("new_id, name"),P.from("beats").select("new_id, name")]);if(!d.error){const E=(d.data||[]).map(C=>({id:String(C.id),name:String(C.name)}));Y(E)}g.error||k((g.data||[]).map(E=>({id:E.new_id,name:E.name}))),w.error||F((w.data||[]).map(E=>({id:E.new_id,name:E.name})))}i()},[]);const ee=i=>{var d;return((d=H.find(g=>g.id===i))==null?void 0:d.name)||i||""},ae=i=>{const d=K.find(g=>g.id===i||g.new_id===i);return(d==null?void 0:d.name)||i||""},c=i=>{var d;return((d=N.find(g=>g.id===i))==null?void 0:d.name)||i||""},o=async()=>{if(t!=null&&t.id)try{j(!0);const{data:i,error:d}=await P.from("notifications").select("*").eq("user_id",t.id).order("created_at",{ascending:!1}).limit(10);if(d)throw d;const g=(i||[]).map(w=>({id:String(w.id),message:String(w.message),created_at:String(w.created_at),is_read:!!w.is_read,type:String(w.type),data:w.data||{}}));s(g),u(g.filter(w=>!w.is_read).length)}catch(i){console.error("Error fetching notifications:",i),Z.error("Failed to load notifications")}finally{j(!1)}},m=async i=>{if(t!=null&&t.id)try{const{error:d}=await P.from("notifications").update({is_read:!0}).eq("id",i).eq("user_id",t.id);if(d)throw d;s(g=>g.map(w=>w.id===i?{...w,is_read:!0}:w)),u(g=>Math.max(0,g-1))}catch(d){console.error("Error marking notification as read:",d),Z.error("Failed to mark notification as read")}},l=async()=>{if(t!=null&&t.id)try{const{error:i}=await P.from("notifications").update({is_read:!0}).eq("user_id",t.id).eq("is_read",!1);if(i)throw i;s(d=>d.map(g=>({...g,is_read:!0}))),u(0)}catch(i){console.error("Error marking all notifications as read:",i),Z.error("Failed to mark all notifications as read")}},A=async i=>{if(V(i),B(null),q(!0),i.data.activity_id){U(!0);try{const d=await Q.getInstance().getById(i.data.activity_id);B(d)}catch{Z.error("Failed to load activity details")}finally{U(!1)}}i.is_read||m(i.id)};return a.useEffect(()=>{if(t!=null&&t.id){o();const i=P.channel(`notifications-${t.id}`).on("postgres_changes",{event:"*",schema:"public",table:"notifications",filter:`user_id=eq.${t.id}`},()=>{o()}).subscribe();return()=>{P.removeChannel(i)}}},[t==null?void 0:t.id]),t?e.jsxs(e.Fragment,{children:[e.jsxs(rt,{children:[e.jsx(at,{asChild:!0,children:e.jsxs(ie,{variant:"ghost",size:"icon",className:"relative h-12 w-12","aria-label":"View notifications",children:[e.jsx(_t,{className:"h-7 w-7"}),n>0&&e.jsx("span",{className:"absolute -right-1 -top-1 flex h-6 w-6 items-center justify-center rounded-full bg-red-500 text-[12px] font-medium text-white",children:n})]})}),e.jsxs(ve,{align:"end",className:"w-80",children:[e.jsxs("div",{className:"flex items-center justify-between p-2 border-b",children:[e.jsx("h3",{className:"font-semibold",children:"Notifications"}),n>0&&e.jsx(ie,{variant:"ghost",size:"sm",onClick:l,className:"text-sm text-blue-600 hover:text-blue-700",children:"Mark all as read"})]}),e.jsx("div",{className:"max-h-[400px] overflow-y-auto",children:f?e.jsx("div",{className:"p-4 text-center text-gray-500",children:"Loading notifications..."}):r.length===0?e.jsx("div",{className:"p-4 text-center text-gray-500",children:"No notifications yet"}):r.map(i=>e.jsx(J,{className:`p-4 hover:bg-gray-50 ${i.is_read?"":"bg-blue-50"}`,onClick:()=>A(i),children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("p",{className:"text-sm font-medium",children:i.message}),e.jsxs("div",{className:"text-xs text-gray-600 flex flex-wrap gap-2",children:[i.data.division_id&&e.jsxs("span",{children:["Division: ",ee(i.data.division_id)]}),i.data.range_id&&e.jsxs("span",{children:["Range: ",ae(i.data.range_id)]}),i.data.activity_id&&e.jsxs("span",{children:["Activity: ",i.data.activity_id]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:new Date(i.created_at).toLocaleString()})]})},i.id))})]})]}),e.jsx(cs,{open:G,onOpenChange:q,children:e.jsxs(it,{children:[e.jsx(lt,{children:e.jsx(ct,{children:"Activity Details"})}),W?e.jsx("div",{className:"p-4 text-center text-gray-500",children:"Loading details..."}):$?e.jsx("div",{className:"space-y-2",children:Object.entries($).map(([i,d])=>{if(d==null||d==="")return null;let g=d;return(i==="associated_division"||i==="associated_division_id")&&(g=ee(d)),(i==="associated_range"||i==="associated_range_id")&&(g=ae(d)),(i==="associated_beat"||i==="associated_beat_id")&&(g=c(d)),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"font-medium capitalize",children:[i.replace(/_/g," "),":"]}),e.jsx("span",{children:typeof g=="object"&&g instanceof Date?g.toLocaleString():g.toString()})]},i)})}):e.jsx("div",{className:"p-4 text-center text-gray-500",children:"No activity details found for this notification."})]})})]}):null}function ps(){const{user:t,signOut:r}=ls(),s=xe(),[n,u]=a.useState(!1),{isOnline:f}=et(),j=async O=>{O.preventDefault(),O.stopPropagation(),console.log("Logout button clicked");try{if(!f){Z.warning("Cannot log out while offline. Please reconnect to the internet and try again.",{duration:5e3});return}console.log("Starting sign out process..."),await r()}catch(V){console.error("Error during sign out:",V),Z.error("Sign out failed. Please try again.")}};return t?e.jsx("header",{className:"sticky top-0 z-50 w-full border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60",children:e.jsxs("div",{className:"container flex flex-col sm:flex-row h-auto sm:h-16 items-center justify-between px-4 sm:px-0 py-2 sm:py-0",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center w-full sm:w-auto",children:[e.jsx("div",{className:"flex-shrink-0 flex items-center gap-2",children:e.jsxs(te,{to:"/",className:"flex items-center gap-2",children:[e.jsxs("span",{className:"relative flex items-center justify-center w-8 h-8",children:[e.jsx("span",{className:"absolute inset-0 bg-gradient-to-r from-blue-500 to-green-500 rounded-full blur-md opacity-30 animate-pulse"}),e.jsx("img",{src:"/elephant_photo.png",alt:"Elephant Logo",className:"relative w-full h-full object-contain"})]}),e.jsx("span",{className:"text-lg sm:text-xl font-bold bg-gradient-to-r from-blue-600 to-green-600 bg-clip-text text-transparent",children:"Eravat"})]})}),e.jsx("div",{className:"sm:hidden ml-auto",children:e.jsxs("button",{onClick:()=>u(!n),className:"p-2 rounded-md hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500","aria-expanded":n,children:[e.jsx("span",{className:"sr-only",children:"Open main menu"}),n?e.jsx(pe,{className:"h-6 w-6","aria-hidden":"true"}):e.jsx(bt,{className:"h-6 w-6","aria-hidden":"true"})]})}),e.jsx("div",{className:`absolute left-0 top-16 w-full bg-white border-b shadow-md z-40 transform transition-all duration-300 ease-in-out ${n?"translate-y-0 opacity-100":"-translate-y-2 opacity-0 pointer-events-none"} sm:hidden`,children:e.jsxs("nav",{className:"flex flex-col items-center py-2 gap-2",children:[(t==null?void 0:t.role)!=="data_collector"&&e.jsx(te,{to:"/dashboard",className:"w-full text-center px-4 py-2 text-sm font-medium text-gray-900 hover:bg-gray-50 transition-colors",onClick:()=>u(!1),children:"Dashboard"}),e.jsx(te,{to:"/report",className:"w-full text-center px-4 py-2 text-sm font-medium text-gray-900 hover:bg-gray-50 transition-colors",onClick:()=>u(!1),children:"Report Activity"})]})}),e.jsxs("nav",{className:"ml-0 sm:ml-6 hidden sm:flex space-x-8",children:[(t==null?void 0:t.role)!=="data_collector"&&e.jsx(te,{to:"/dashboard",className:"inline-flex items-center px-1 pt-1 text-sm font-medium text-gray-900 hover:text-blue-600 transition-colors",children:"Dashboard"}),e.jsx(te,{to:"/report",className:"inline-flex items-center px-1 pt-1 text-sm font-medium text-gray-900 hover:text-blue-600 transition-colors",children:"Report Activity"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4 mt-2 sm:mt-0 w-full sm:w-auto justify-end",children:[!f&&e.jsxs("div",{className:"flex items-center text-sm text-amber-600 mr-2",children:[e.jsx(St,{className:"h-4 w-4 mr-1"}),e.jsx("span",{children:"Offline"})]}),e.jsx(gs,{}),e.jsxs(rt,{children:[e.jsx(at,{asChild:!0,children:e.jsx(ie,{variant:"ghost",className:"relative h-12 px-4 rounded-full w-full sm:w-auto hover:bg-gray-100 transition-colors",children:e.jsx("span",{className:"text-xs sm:text-sm font-medium truncate max-w-[120px] sm:max-w-none",children:t==null?void 0:t.email})})}),e.jsxs(ve,{className:"w-56",align:"end",forceMount:!0,children:[e.jsx(ot,{className:"font-normal",children:e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("p",{className:"text-sm font-medium leading-none",children:(t==null?void 0:t.email)||(t==null?void 0:t.phone)}),e.jsx("p",{className:"text-xs leading-none text-muted-foreground capitalize",children:t==null?void 0:t.role.replace("_"," ")})]})}),e.jsx(ge,{}),(t==null?void 0:t.role)==="admin"&&e.jsxs(e.Fragment,{children:[e.jsx(J,{onClick:()=>s("/admin"),children:"Admin Dashboard"}),e.jsx(J,{onClick:()=>s("/admin/users"),children:"User Management"}),e.jsx(J,{onClick:()=>s("/admin/observations"),children:"Observations"}),e.jsx(J,{onClick:()=>s("/admin/settings"),children:"Settings"}),e.jsx(J,{onClick:()=>s("/admin/logs"),children:"System Logs"}),e.jsx(ge,{})]}),e.jsx(J,{asChild:!0,children:e.jsxs("button",{className:"w-full text-left flex items-center px-2 py-1.5 text-sm",onClick:O=>{O.preventDefault(),O.stopPropagation(),console.log("Logout button clicked directly"),j(O)},children:[e.jsx(jt,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Log out"})]})})]})]})]})]})}):null}const hs=()=>{const t=xe(),{setNavigation:r}=ye();return a.useEffect(()=>(r(t),()=>{}),[t,r]),null},xs=a.lazy(()=>D(()=>import("./Index-BFNMwdU1.js"),__vite__mapDeps([0,1,2,3,4]))),ws=a.lazy(()=>D(()=>import("./NotFound-z1ctJDKU.js"),__vite__mapDeps([5,1,2]))),ys=a.lazy(()=>D(()=>import("./ReportActivityPage-B8ifQnp8.js"),__vite__mapDeps([6,1,2,3,4,7,8,9]))),vs=a.lazy(()=>D(()=>import("./Dashboard-C3rbX_7p.js"),__vite__mapDeps([10,1,2,3,9,4,8]))),_s=a.lazy(()=>D(()=>import("./Admin-_JzEYALo.js"),__vite__mapDeps([11,1,2,3,4]))),bs=a.lazy(()=>D(()=>import("./Login-4WZ46U6K.js"),__vite__mapDeps([12,1,2,7,8,4,3,13]))),Ss=a.lazy(()=>D(()=>import("./AdminUsers-B88ZY8q-.js"),__vite__mapDeps([14,1,2,7,8,4,3,9,15]))),js=a.lazy(()=>D(()=>import("./AdminObservations-DkYSWAl7.js"),__vite__mapDeps([16,1,2,3,15,7,9,4,13,8]))),Ns=a.lazy(()=>D(()=>import("./AdminStatistics-BfAAyQDP.js"),__vite__mapDeps([17,1,2,3,4]))),Es=a.lazy(()=>D(()=>import("./AdminSettings-DS4HxaWP.js"),__vite__mapDeps([18,1,2,3,7,19,4,9,15]))),Ps=a.lazy(()=>D(()=>import("./AdminNotifications-BLAtIi3N.js"),__vite__mapDeps([20,1,2,3,7,19,4,9])));class Os extends a.Component{constructor(r){super(r),this.state={hasError:!1}}static getDerivedStateFromError(r){return{hasError:!0}}componentDidCatch(r,s){console.error("Error caught by ErrorBoundary:",r,s)}render(){return this.state.hasError?this.props.fallback:this.props.children}}const As=new Nt,Is=()=>e.jsxs("div",{className:"flex flex-col min-h-screen",children:[e.jsx(ps,{}),e.jsx(hs,{}),e.jsx("main",{className:"flex-grow container mx-auto p-4",children:e.jsx(Pe,{})}),e.jsx(ts,{})]}),ks=Et([{path:"/login",element:e.jsx(a.Suspense,{fallback:e.jsx(I,{}),children:e.jsx(bs,{})})},{path:"/",element:e.jsx(ss,{}),children:[{element:e.jsx(Is,{}),children:[{index:!0,element:e.jsx(a.Suspense,{fallback:e.jsx(I,{}),children:e.jsx(xs,{})})},{path:"report-activity",element:e.jsx(a.Suspense,{fallback:e.jsx(I,{}),children:e.jsx(ys,{})})},{path:"dashboard",element:e.jsx(Os,{fallback:e.jsx("div",{children:"Failed to load dashboard. Please try refreshing the page."}),children:e.jsx(a.Suspense,{fallback:e.jsx(I,{}),children:e.jsx(vs,{})})})},{path:"admin",element:e.jsx(a.Suspense,{fallback:e.jsx(I,{}),children:e.jsx(_s,{})})},{path:"admin/users",element:e.jsx(a.Suspense,{fallback:e.jsx(I,{}),children:e.jsx(Ss,{})})},{path:"admin/observations",element:e.jsx(a.Suspense,{fallback:e.jsx(I,{}),children:e.jsx(js,{})})},{path:"admin/statistics",element:e.jsx(a.Suspense,{fallback:e.jsx(I,{}),children:e.jsx(Ns,{})})},{path:"admin/settings",element:e.jsx(a.Suspense,{fallback:e.jsx(I,{}),children:e.jsx(Es,{})})},{path:"admin/notifications",element:e.jsx(a.Suspense,{fallback:e.jsx(I,{}),children:e.jsx(Ps,{})})}]}]},{path:"*",element:e.jsx(a.Suspense,{fallback:e.jsx(I,{}),children:e.jsx(ws,{})})}]),Cs=({children:t})=>e.jsx(Pt,{client:As,children:e.jsx(Yt,{children:e.jsxs(es,{children:[e.jsx(Wt,{}),e.jsx(Ht,{}),t]})})}),Ds=()=>e.jsx(Ot,{router:ks}),Rs=()=>e.jsx(Cs,{children:e.jsx(Ds,{})});window.CESIUM_BASE_URL="/cesium";At.createRoot(document.getElementById("root")).render(e.jsx(Rs,{}));export{ie as B,cs as D,P as a,ls as b,v as c,Ms as d,it as e,lt as f,ct as g,ms as h,us as i,rs as j,fs as s,ye as u};
//# sourceMappingURL=index-CVoE3lMI.js.map
