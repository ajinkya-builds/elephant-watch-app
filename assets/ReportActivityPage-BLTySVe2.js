import{c as H,r as l,j as e,d as ie,P as U,e as G,f as _e,g as ot,h as ct,R as dt,i as le,I as ut,k as se,l as mt,m as pt,C as ht,n as xt,o as v,B as C,s as ae,u as Ce,a as ke,p as ft,q as vt,t as gt}from"./index-BN8LcDn3.js";import{C as I,c as L,a as bt,b as yt}from"./card-BqoXHyi7.js";import{I as S}from"./input-BTC4v1fB.js";import{L as y}from"./label-CQ1W_hkI.js";import{u as jt}from"./index-DKvGMIOH.js";import{i as oe,S as ce,a as de,b as ue,c as me,d as T}from"./select-Cjf5vBA4.js";import{r as Nt}from"./debounce-BM2lNiU-.js";import{T as wt,a as St,b as te}from"./tabs-B5ty2nmF.js";import{R as _t}from"./refresh-cw-EX9Ac38o.js";import{A as re}from"./alert-circle-BBCt6jWM.js";import{M as Ct}from"./map-pin-D0gPd5_H.js";import{F as kt}from"./file-text-BmMWWQRF.js";/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=H("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=H("Compass",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76",key:"m9r19z"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pt=H("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=H("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rt=H("Unlock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Et=H("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);var he="Progress",xe=100,[Dt,Ps]=ie(he),[It,Ft]=Dt(he),Pe=l.forwardRef((t,s)=>{const{__scopeProgress:a,value:r=null,max:i,getValueLabel:o=At,...c}=t;(i||i===0)&&!je(i)&&console.error(Tt(`${i}`,"Progress"));const u=je(i)?i:xe;r!==null&&!Ne(r,u)&&console.error(Lt(`${r}`,"Progress"));const n=Ne(r,u)?r:null,x=X(n)?o(n,u):void 0;return e.jsx(It,{scope:a,value:n,max:u,children:e.jsx(U.div,{"aria-valuemax":u,"aria-valuemin":0,"aria-valuenow":X(n)?n:void 0,"aria-valuetext":x,role:"progressbar","data-state":De(n,u),"data-value":n??void 0,"data-max":u,...c,ref:s})})});Pe.displayName=he;var Re="ProgressIndicator",Ee=l.forwardRef((t,s)=>{const{__scopeProgress:a,...r}=t,i=Ft(Re,a);return e.jsx(U.div,{"data-state":De(i.value,i.max),"data-value":i.value??void 0,"data-max":i.max,...r,ref:s})});Ee.displayName=Re;function At(t,s){return`${Math.round(t/s*100)}%`}function De(t,s){return t==null?"indeterminate":t===s?"complete":"loading"}function X(t){return typeof t=="number"}function je(t){return X(t)&&!isNaN(t)&&t>0}function Ne(t,s){return X(t)&&!isNaN(t)&&t<=s&&t>=0}function Tt(t,s){return`Invalid prop \`max\` of value \`${t}\` supplied to \`${s}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${xe}\`.`}function Lt(t,s){return`Invalid prop \`value\` of value \`${t}\` supplied to \`${s}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${xe} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var Ie=Pe,Ot=Ee;const fe=l.forwardRef(({className:t,value:s,...a},r)=>e.jsx(Ie,{ref:r,className:G("relative h-2 w-full overflow-hidden rounded-full bg-gray-200 dark:bg-gray-800",t),...a,children:e.jsx(Ot,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(s||0)}%)`}})}));fe.displayName=Ie.displayName;const we={activity_date:null,activity_time:null,observation_type:null,latitude:null,longitude:null,total_elephants:null,male_elephants:null,female_elephants:null,unknown_elephants:null,calves:null,indirect_sighting_type:null,loss_type:null,compass_bearing:null,photo_url:null,distance:null,distance_unit:null,description:null},Fe=l.createContext(void 0);function Mt({children:t}){const[s,a]=l.useState("dateTimeLocation"),[r,i]=l.useState(we),o=["dateTimeLocation","observationType","compassBearing","photo"],c=()=>{const h=o.indexOf(s);h<o.length-1&&a(o[h+1])},u=()=>{const h=o.indexOf(s);h>0&&a(o[h-1])},n=h=>{i(m=>({...m,...h}))},x=h=>{switch(h){case"dateTimeLocation":return!!r.activity_date&&!!r.activity_time&&r.latitude!==null&&r.longitude!==null;case"observationType":return!!r.observation_type;case"compassBearing":return r.compass_bearing!==null;case"photo":return!0;default:return!1}},p=()=>s===o[o.length-1],g=()=>{i(we),a("dateTimeLocation")};return e.jsx(Fe.Provider,{value:{currentStep:s,formData:r,goToNextStep:c,goToPreviousStep:u,updateFormData:n,isStepValid:x,isLastStep:p,resetForm:g},children:t})}function z(){const t=l.useContext(Fe);if(t===void 0)throw new Error("useActivityForm must be used within an ActivityFormProvider");return t}const Gt=()=>{const[t,s]=l.useState({latitude:null,longitude:null,error:null});return l.useEffect(()=>{if(!navigator.geolocation){s(i=>({...i,error:"Geolocation is not supported by your browser"}));return}const a=i=>{s({latitude:i.coords.latitude,longitude:i.coords.longitude,error:null})},r=i=>{s(o=>({...o,error:i.message}))};navigator.geolocation.getCurrentPosition(a,r,{enableHighAccuracy:!0,timeout:5e3,maximumAge:0})},[]),t};function Bt(){const{formData:t,updateFormData:s}=z(),{latitude:a,longitude:r,error:i}=Gt();return l.useEffect(()=>{a&&r&&s({latitude:a,longitude:r})},[a,r,s]),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(y,{htmlFor:"activity_date",children:"Date"}),e.jsx(S,{id:"activity_date",type:"date",value:t.activity_date instanceof Date?t.activity_date.toISOString().split("T")[0]:t.activity_date||"",onChange:o=>s({activity_date:o.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"activity_time",children:"Time"}),e.jsx(S,{id:"activity_time",type:"time",value:t.activity_time||"",onChange:o=>s({activity_time:o.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{children:"Location"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(y,{htmlFor:"latitude",className:"text-sm text-gray-500",children:"Latitude"}),e.jsx(S,{id:"latitude",type:"number",step:"any",value:t.latitude||"",onChange:o=>s({latitude:parseFloat(o.target.value)}),required:!0})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"longitude",className:"text-sm text-gray-500",children:"Longitude"}),e.jsx(S,{id:"longitude",type:"number",step:"any",value:t.longitude||"",onChange:o=>s({longitude:parseFloat(o.target.value)}),required:!0})]})]}),i&&e.jsxs("p",{className:"text-sm text-red-500 mt-1",children:["Error getting location: ",i]})]})]})})}var ve="Radio",[Vt,Ae]=ie(ve),[$t,Ht]=Vt(ve),Te=l.forwardRef((t,s)=>{const{__scopeRadio:a,name:r,checked:i=!1,required:o,disabled:c,value:u="on",onCheck:n,form:x,...p}=t,[g,h]=l.useState(null),m=le(s,j=>h(j)),f=l.useRef(!1),k=g?x||!!g.closest("form"):!0;return e.jsxs($t,{scope:a,checked:i,disabled:c,children:[e.jsx(U.button,{type:"button",role:"radio","aria-checked":i,"data-state":Ge(i),"data-disabled":c?"":void 0,disabled:c,value:u,...p,ref:m,onClick:se(t.onClick,j=>{i||n==null||n(),k&&(f.current=j.isPropagationStopped(),f.current||j.stopPropagation())})}),k&&e.jsx(Me,{control:g,bubbles:!f.current,name:r,value:u,checked:i,required:o,disabled:c,form:x,style:{transform:"translateX(-100%)"}})]})});Te.displayName=ve;var Le="RadioIndicator",Oe=l.forwardRef((t,s)=>{const{__scopeRadio:a,forceMount:r,...i}=t,o=Ht(Le,a);return e.jsx(mt,{present:r||o.checked,children:e.jsx(U.span,{"data-state":Ge(o.checked),"data-disabled":o.disabled?"":void 0,...i,ref:s})})});Oe.displayName=Le;var Ut="RadioBubbleInput",Me=l.forwardRef(({__scopeRadio:t,control:s,checked:a,bubbles:r=!0,...i},o)=>{const c=l.useRef(null),u=le(c,o),n=jt(a),x=pt(s);return l.useEffect(()=>{const p=c.current;if(!p)return;const g=window.HTMLInputElement.prototype,m=Object.getOwnPropertyDescriptor(g,"checked").set;if(n!==a&&m){const f=new Event("click",{bubbles:r});m.call(p,a),p.dispatchEvent(f)}},[n,a,r]),e.jsx(U.input,{type:"radio","aria-hidden":!0,defaultChecked:a,...i,tabIndex:-1,ref:u,style:{...i.style,...x,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});Me.displayName=Ut;function Ge(t){return t?"checked":"unchecked"}var qt=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],J="RadioGroup",[zt,Rs]=ie(J,[_e,Ae]),Be=_e(),Ve=Ae(),[Wt,Yt]=zt(J),$e=l.forwardRef((t,s)=>{const{__scopeRadioGroup:a,name:r,defaultValue:i,value:o,required:c=!1,disabled:u=!1,orientation:n,dir:x,loop:p=!0,onValueChange:g,...h}=t,m=Be(a),f=ot(x),[k,j]=ct({prop:o,defaultProp:i??null,onChange:g,caller:J});return e.jsx(Wt,{scope:a,name:r,required:c,disabled:u,value:k,onValueChange:j,children:e.jsx(dt,{asChild:!0,...m,orientation:n,dir:f,loop:p,children:e.jsx(U.div,{role:"radiogroup","aria-required":c,"aria-orientation":n,"data-disabled":u?"":void 0,dir:f,...h,ref:s})})})});$e.displayName=J;var He="RadioGroupItem",Ue=l.forwardRef((t,s)=>{const{__scopeRadioGroup:a,disabled:r,...i}=t,o=Yt(He,a),c=o.disabled||r,u=Be(a),n=Ve(a),x=l.useRef(null),p=le(s,x),g=o.value===i.value,h=l.useRef(!1);return l.useEffect(()=>{const m=k=>{qt.includes(k.key)&&(h.current=!0)},f=()=>h.current=!1;return document.addEventListener("keydown",m),document.addEventListener("keyup",f),()=>{document.removeEventListener("keydown",m),document.removeEventListener("keyup",f)}},[]),e.jsx(ut,{asChild:!0,...u,focusable:!c,active:g,children:e.jsx(Te,{disabled:c,required:o.required,checked:g,...n,...i,name:o.name,ref:p,onCheck:()=>o.onValueChange(i.value),onKeyDown:se(m=>{m.key==="Enter"&&m.preventDefault()}),onFocus:se(i.onFocus,()=>{var m;h.current&&((m=x.current)==null||m.click())})})})});Ue.displayName=He;var Kt="RadioGroupIndicator",qe=l.forwardRef((t,s)=>{const{__scopeRadioGroup:a,...r}=t,i=Ve(a);return e.jsx(Oe,{...i,...r,ref:s})});qe.displayName=Kt;var ze=$e,We=Ue,Xt=qe;const Y=l.forwardRef(({className:t,...s},a)=>e.jsx(ze,{className:G("grid gap-2",t),...s,ref:a}));Y.displayName=ze.displayName;const K=l.forwardRef(({className:t,...s},a)=>e.jsx(We,{ref:a,className:G("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),...s,children:e.jsx(Xt,{className:"flex items-center justify-center",children:e.jsx(ht,{className:"h-2.5 w-2.5 fill-current text-current"})})}));K.displayName=We.displayName;var Jt=Nt();const Qt=xt(Jt),Ye=l.forwardRef(({value:t,onChange:s,options:a,placeholder:r,className:i},o)=>oe()?e.jsxs("select",{value:t||"",onChange:c=>s(c.target.value),className:G("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",i),ref:o,style:{WebkitAppearance:"none",MozAppearance:"none",width:"100%",minHeight:48,fontSize:16,border:"2px solid #1976d2",borderRadius:6,background:"#fff",color:"#222",margin:"8px 0",padding:"8px 12px",appearance:"auto",boxShadow:"0 0 0 2px #1976d2 inset"},children:[e.jsx("option",{value:"",children:r||"Select an option"}),a.map(c=>e.jsx("option",{value:c.value,children:c.label},c.value))]}):e.jsxs(ce,{value:t,onValueChange:s,children:[e.jsx(de,{className:i||"w-full h-12 text-base",children:e.jsx(ue,{placeholder:r||"Select an option"})}),e.jsx(me,{children:a.map(c=>e.jsx(T,{value:c.value,children:c.label},c.value))})]}));Ye.displayName="CrossPlatformSelect";function Zt({value:t,onChange:s,options:a,placeholder:r,className:i}){return e.jsxs("select",{value:t||"",onChange:o=>s(o.target.value),className:i||"w-full h-12 text-base border rounded",style:{width:"100%",minHeight:48,fontSize:16,border:"1px solid #ccc",borderRadius:6,background:"#fff",color:"#222",margin:"8px 0",padding:"8px 12px"},children:[e.jsx("option",{value:"",children:r||"Select an option"}),a.map(o=>e.jsx("option",{value:o.value,children:o.label},o.value))]})}const es=({options:t,value:s,onChange:a,placeholder:r,className:i})=>oe()?e.jsx(Zt,{options:t,value:s,onChange:a,placeholder:r,className:i}):e.jsx(Ye,{options:t,value:s,onChange:a,placeholder:r,className:i}),ts=[{value:"direct",label:"Direct Sighting"},{value:"indirect",label:"Indirect Sighting"},{value:"loss",label:"Loss Report"}],ss=[{value:"Pugmark",label:"Pugmark"},{value:"Dung",label:"Dung"},{value:"Broken Branches",label:"Broken Branches"},{value:"Sound",label:"Sound"},{value:"Eyewitness",label:"Eyewitness"}],as=[{value:"No loss",label:"No Loss"},{value:"crop",label:"Crop Damage"},{value:"livestock",label:"Livestock Loss"},{value:"property",label:"Property Damage"},{value:"fencing",label:"Fencing Damage"},{value:"solar panels",label:"Solar Panel Damage"},{value:"FD establishment",label:"FD Establishment Damage"},{value:"Other",label:"Other Loss"}],rs=()=>{const{formData:t,updateFormData:s}=z(),a=n=>{s({observation_type:n})},r=n=>{s({indirect_sighting_type:n})},i=n=>{s({loss_type:n})},o=l.useMemo(()=>Qt(n=>{s(n)},300),[s]),c=l.useCallback((n,x)=>{const p=parseInt(x);!isNaN(p)&&p>=0&&o({[n]:p})},[o]),u=l.useCallback((n,x)=>{s({[n]:x})},[s]);return e.jsxs("div",{className:"space-y-6",children:[e.jsx(I,{children:e.jsx(L,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(y,{children:"Type of Observation"}),e.jsx(Y,{value:t.observation_type,onValueChange:a,className:"mt-2",children:ts.map(n=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(K,{value:n.value,id:n.value}),e.jsx(y,{htmlFor:n.value,children:n.label})]},n.value))})]}),t.observation_type==="indirect"&&e.jsxs("div",{children:[e.jsx(y,{children:"Indirect Sighting Type"}),e.jsx(Y,{value:t.indirect_sighting_type,onValueChange:r,className:"mt-2",children:ss.map(n=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(K,{value:n.value,id:n.value}),e.jsx(y,{htmlFor:n.value,children:n.label})]},n.value))})]}),t.observation_type==="loss"&&e.jsxs("div",{children:[e.jsx(y,{children:"Loss Type"}),e.jsx(Y,{value:t.loss_type,onValueChange:i,className:"mt-2",children:as.map(n=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(K,{value:n.value,id:n.value}),e.jsx(y,{htmlFor:n.value,children:n.label})]},n.value))})]})]})})}),t.observation_type==="direct"&&e.jsx(I,{children:e.jsx(L,{className:"pt-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"total_elephants",children:"Total Elephants"}),e.jsx(S,{type:"number",id:"total_elephants",min:"0",value:t.total_elephants||"",onChange:n=>c("total_elephants",n.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"male_elephants",children:"Male Elephants"}),e.jsx(S,{type:"number",id:"male_elephants",min:"0",value:t.male_elephants||"",onChange:n=>c("male_elephants",n.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"female_elephants",children:"Female Elephants"}),e.jsx(S,{type:"number",id:"female_elephants",min:"0",value:t.female_elephants||"",onChange:n=>c("female_elephants",n.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"unknown_elephants",children:"Unknown Elephants"}),e.jsx(S,{type:"number",id:"unknown_elephants",min:"0",value:t.unknown_elephants||"",onChange:n=>c("unknown_elephants",n.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"calves",children:"Calves"}),e.jsx(S,{type:"number",id:"calves",min:"0",value:t.calves||"",onChange:n=>c("calves",n.target.value)})]})]})})}),t.observation_type==="indirect"&&e.jsx(I,{children:e.jsx(L,{className:"pt-6",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"indirect_sighting_type",children:"Type of Indirect Sighting"}),e.jsxs(ce,{value:t.indirect_sighting_type||"",onValueChange:n=>u("indirect_sighting_type",n),children:[e.jsx(de,{className:"w-full bg-white border-gray-200 shadow-sm hover:border-blue-500 transition-colors",children:e.jsx(ue,{placeholder:"Select type of indirect sighting"})}),e.jsxs(me,{children:[e.jsx(T,{value:"Pugmark",children:"Pugmark"}),e.jsx(T,{value:"Dung",children:"Dung"}),e.jsx(T,{value:"Broken Branches",children:"Broken Branches"}),e.jsx(T,{value:"Sound",children:"Sound"}),e.jsx(T,{value:"Eyewitness",children:"Eyewitness"})]})]})]})})}),t.observation_type==="loss"&&e.jsx(I,{children:e.jsx(L,{className:"pt-6",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"loss_type",children:"Type of Loss"}),oe()?e.jsxs("select",{id:"loss_type",value:t.loss_type??void 0,onChange:n=>u("loss_type",n.target.value),className:"w-full h-12 text-base border rounded",children:[e.jsx("option",{value:"",children:"Select type of loss"}),e.jsx("option",{value:"No loss",children:"No loss"}),e.jsx("option",{value:"crop",children:"Crop"}),e.jsx("option",{value:"livestock",children:"Livestock"}),e.jsx("option",{value:"property",children:"Property"}),e.jsx("option",{value:"fencing",children:"Fencing"}),e.jsx("option",{value:"solar panels",children:"Solar Panels"}),e.jsx("option",{value:"FD establishment",children:"FD Establishment"}),e.jsx("option",{value:"Other",children:"Other"})]}):e.jsx(es,{value:t.loss_type??"",onChange:n=>u("loss_type",n),options:[{value:"No loss",label:"No loss"},{value:"crop",label:"Crop"},{value:"livestock",label:"Livestock"},{value:"property",label:"Property"},{value:"fencing",label:"Fencing"},{value:"solar panels",label:"Solar Panels"},{value:"FD establishment",label:"FD Establishment"},{value:"Other",label:"Other"}],placeholder:"Select type of loss",className:"w-full h-12 text-base"})]})})})]})},Se=1,ns=10;function is(){const{formData:t,updateFormData:s}=z(),[a,r]=l.useState(!1),[i,o]=l.useState(!1),[c,u]=l.useState(!1),[n,x]=l.useState([]),[p,g]=l.useState(0),[h,m]=l.useState(null),[f,k]=l.useState(!1),[j,Q]=l.useState("gps"),[P,R]=l.useState({heading:0,accuracy:0,isGPSBased:!1,isErratic:!1,speed:0}),B=l.useRef([]),O=l.useRef(null),F=l.useRef(null),N=l.useRef(null),w=l.useRef(null),q=l.useRef(null);l.useEffect(()=>{const d=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;k(d);const b=localStorage.getItem("compassCalibrationOffset");b&&g(parseFloat(b));const _=localStorage.getItem("compassMode");return _&&Q(_),window.DeviceOrientationEvent?m(!d):(v.error("Device orientation is not supported on this device"),m(!1)),()=>{N.current!==null&&navigator.geolocation.clearWatch(N.current),w.current&&w.current.srcObject&&w.current.srcObject.getTracks().forEach(A=>A.stop())}},[]);const V=d=>{const b=parseInt(d.target.value);!isNaN(b)&&b>=0&&b<=360&&s({compass_bearing:b})},M=d=>{const b=parseFloat(d.target.value);s({distance:isNaN(b)?null:b})},Qe=d=>{s({distance_unit:d})},Ze=()=>{j==="visual"?st():et()},et=()=>{u(!0),v.info("Point your device north and tap 'Set North' when ready")},tt=()=>{if(F.current!==null){const d=(360-F.current)%360;g(d),localStorage.setItem("compassCalibrationOffset",d.toString()),u(!1),v.success("North direction set successfully")}},st=async()=>{try{const d=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});w.current&&(w.current.srcObject=d,u(!0),v.info("Align the camera with a known landmark and tap 'Set Direction'"))}catch(d){console.error("Error accessing camera:",d),v.error("Failed to access camera")}},at=()=>{if(q.current&&w.current){const d=q.current,b=w.current,_=d.getContext("2d");if(_){_.drawImage(b,0,0,d.width,d.height),_.getImageData(0,0,d.width,d.height);const E=0;g(E),localStorage.setItem("compassCalibrationOffset",E.toString()),u(!1),v.success("Direction set from visual reference")}}},be=l.useCallback(d=>{if(!a||i||!O.current){O.current=d;return}const{speed:b,accuracy:_}=d.coords,E=O.current.coords,A=d.coords;if(R(D=>({...D,speed:b||0,accuracy:_<=ns?1:.5})),b&&b>Se){const D=Math.round((Math.atan2(A.longitude-E.longitude,A.latitude-E.latitude)*180/Math.PI+360)%360);R(ee=>({...ee,heading:D,isGPSBased:!0,isErratic:!1})),i||s({compass_bearing:D})}else if(j==="manual"&&F.current!==null){const D=(F.current+p)%360;R(ee=>({...ee,heading:D,isGPSBased:!1,isErratic:!1})),i||s({compass_bearing:D})}O.current=d},[a,i,s,j,p]),Z=l.useCallback(d=>{if(!a||i)return;let b=0;if(f&&d.webkitCompassHeading?b=d.webkitCompassHeading:d.alpha!==null&&(b=Math.round((360-d.alpha)%360)),F.current=b,j==="manual"&&P.speed<=Se){const _=(b+p)%360;B.current=[...B.current.slice(-4),_];const E=Math.round(B.current.reduce((A,D)=>A+D,0)/B.current.length);R(A=>({...A,heading:E,accuracy:.8,isGPSBased:!1,isErratic:!1})),i||s({compass_bearing:E})}},[a,i,p,s,j,P.speed]);l.useEffect(()=>(a&&(N.current=navigator.geolocation.watchPosition(be,d=>console.error("GPS Error:",d),{enableHighAccuracy:!0}),j==="manual"&&window.addEventListener("deviceorientation",Z)),()=>{N.current!==null&&navigator.geolocation.clearWatch(N.current),window.removeEventListener("deviceorientation",Z)}),[a,be,Z,j]);const rt=()=>{r(!a),a?v.info("Compass tracking stopped"):v.info("Compass tracking started")},nt=()=>{o(!i),i?v.info("Compass bearing unlocked"):v.info("Compass bearing locked")},it=d=>{Q(d),localStorage.setItem("compassMode",d),v.info(`Switched to ${d} mode`)},lt=d=>d>=.8?"bg-green-500":d>=.5?"bg-yellow-500":"bg-red-500";return e.jsxs("div",{className:"space-y-6",children:[e.jsx(I,{children:e.jsx(L,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx(wt,{defaultValue:j,onValueChange:d=>it(d),children:e.jsxs(St,{children:[e.jsxs(te,{value:"gps",children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"GPS"]}),e.jsxs(te,{value:"manual",children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Manual"]}),e.jsxs(te,{value:"visual",children:[e.jsx(pe,{className:"w-4 h-4 mr-2"}),"Visual"]})]})}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(C,{variant:a?"destructive":"default",onClick:rt,className:"flex items-center space-x-2",children:[e.jsx(ne,{className:`w-4 h-4 ${a?"animate-spin":""}`}),e.jsx("span",{children:a?"Stop Tracking":"Start Tracking"})]}),e.jsxs(C,{variant:i?"default":"outline",onClick:nt,className:"flex items-center space-x-2",disabled:!a,children:[i?e.jsx(Pt,{className:"w-4 h-4"}):e.jsx(Rt,{className:"w-4 h-4"}),e.jsx("span",{children:i?"Unlock":"Lock"})]}),c?e.jsxs(C,{variant:"default",onClick:j==="visual"?at:tt,className:"flex items-center space-x-2",children:[e.jsx(ye,{className:"w-4 h-4"}),e.jsxs("span",{children:["Set ",j==="visual"?"Direction":"North"]})]}):e.jsxs(C,{variant:"outline",onClick:Ze,className:"flex items-center space-x-2",disabled:!a,children:[e.jsx(_t,{className:`w-4 h-4 ${c?"animate-spin":""}`}),e.jsx("span",{children:"Calibrate"})]})]}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx(y,{htmlFor:"compass_bearing",className:"text-lg",children:"Compass Bearing (0-360°)"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(S,{type:"number",id:"compass_bearing",min:"0",max:"360",value:t.compass_bearing||"",onChange:V,className:"w-32 text-center",disabled:a&&!i}),e.jsx("span",{className:"text-lg",children:"°"})]})]}),a&&e.jsxs("div",{className:"w-full space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Accuracy:"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(fe,{value:P.accuracy*100,className:"w-24"}),e.jsx("span",{className:`w-3 h-3 rounded-full ${lt(P.accuracy)}`})]})]}),P.isGPSBased&&e.jsxs("div",{className:"text-sm text-blue-500",children:["Using GPS-based heading (Speed: ",P.speed.toFixed(1)," m/s)"]}),P.isErratic&&e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-red-500",children:[e.jsx(re,{className:"w-4 h-4"}),e.jsx("span",{children:"Compass readings are erratic. Please calibrate or use manual mode."})]})]}),j==="visual"&&c&&e.jsxs("div",{className:"relative w-full aspect-video",children:[e.jsx("video",{ref:w,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover rounded-lg"}),e.jsx("canvas",{ref:q,className:"hidden",width:640,height:480}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-32 h-32 border-2 border-white rounded-full opacity-50"})})]}),e.jsxs("div",{className:"text-sm text-gray-500 text-center max-w-md",children:["Enter the compass bearing in degrees, where:",e.jsxs("ul",{className:"mt-2 space-y-1",children:[e.jsx("li",{children:"0° or 360° = North"}),e.jsx("li",{children:"90° = East"}),e.jsx("li",{children:"180° = South"}),e.jsx("li",{children:"270° = West"})]})]})]})})}),e.jsx(I,{children:e.jsx(L,{className:"pt-6",children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"distance",children:"Distance"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(S,{id:"distance",type:"number",min:"0",value:t.distance??"",onChange:M,placeholder:"Enter distance"}),e.jsxs(ce,{value:t.distance_unit??"meters",onValueChange:Qe,children:[e.jsx(de,{className:"w-[120px]",children:e.jsx(ue,{placeholder:"Unit"})}),e.jsxs(me,{children:[e.jsx(T,{value:"meters",children:"Meters"}),e.jsx(T,{value:"feet",children:"Feet"})]})]})]})]})})})})]})}const ls=()=>{const{formData:t,updateFormData:s}=z(),[a,r]=l.useState(!1),i=l.useRef(null),o=async u=>{var x;const n=(x=u.target.files)==null?void 0:x[0];if(n){if(!n.type.startsWith("image/")){v.error("Please select an image file");return}if(n.size>5*1024*1024){v.error("Image size should be less than 5MB");return}r(!0);try{const p=n.name.split(".").pop(),h=`activity-photos/${`${Math.random()}.${p}`}`,{error:m}=await ae.storage.from("photos").upload(h,n);if(m)throw m;const{data:{publicUrl:f}}=ae.storage.from("photos").getPublicUrl(h);s({photo_url:f}),v.success("Photo uploaded successfully")}catch(p){console.error("Error uploading photo:",p),v.error("Failed to upload photo")}finally{r(!1)}}},c=()=>{i.current&&i.current.click()};return e.jsx("div",{className:"space-y-6",children:e.jsx(I,{children:e.jsx(L,{className:"pt-6",children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx(y,{children:"Photo"}),e.jsx("div",{className:"mt-2 flex flex-col items-center justify-center",children:t.photo_url?e.jsxs("div",{className:"relative w-full max-w-md",children:[e.jsx("img",{src:t.photo_url,alt:"Activity photo",className:"w-full h-64 object-cover rounded-lg"}),e.jsx(C,{variant:"destructive",size:"sm",className:"absolute top-2 right-2",onClick:()=>s({photo_url:void 0}),children:"Remove"})]}):e.jsxs("div",{className:"w-full max-w-md h-64 border-2 border-dashed border-gray-300 rounded-lg flex flex-col items-center justify-center",children:[e.jsx(pe,{className:"w-12 h-12 text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"No photo selected"}),e.jsxs(C,{onClick:c,disabled:a,children:[e.jsx(Et,{className:"w-4 h-4 mr-2"}),a?"Uploading...":"Upload Photo"]}),e.jsx("input",{ref:i,type:"file",accept:"image/*",capture:"environment",onChange:o,className:"hidden"})]})})]})})})})})},os=()=>{if(typeof window>"u")return!1;const t=window.navigator.userAgent.toLowerCase();return t.includes("android")&&t.includes("wv")},cs=()=>os()?{isOnline:async()=>{try{return await window.Android.isNetworkAvailable()}catch(t){return console.warn("Failed to check network status in Android:",t),navigator.onLine}}}:{isOnline:async()=>navigator.onLine},W=cs(),ds=async()=>{try{if(typeof window>"u"||!navigator.onLine||typeof(W==null?void 0:W.isOnline)=="function"&&!await W.isOnline())return!1;const t=new AbortController,s=setTimeout(()=>t.abort(),3e3);try{const a=await fetch("https://httpbin.org/get",{method:"HEAD",signal:t.signal,cache:"no-store"});return clearTimeout(s),a.ok}catch{return console.warn("Network check failed, falling back to basic online check"),navigator.onLine}}catch(t){return console.warn("Network check failed:",t),!1}},ge=()=>{const[t,s]=l.useState(!0);return l.useEffect(()=>{const a=async()=>{const c=await ds();s(c)};a();const r=()=>{s(!0),a()},i=()=>{s(!1)};window.addEventListener("online",r),window.addEventListener("offline",i);const o=setInterval(a,3e4);return()=>{window.removeEventListener("online",r),window.removeEventListener("offline",i),clearInterval(o)}},[]),t};function us(){const t=ge();return e.jsx("div",{className:"fixed bottom-4 right-4 z-50",children:e.jsx("div",{className:`px-4 py-2 rounded-full shadow-lg ${t?"bg-green-500":"bg-red-500"} text-white`,children:t?"Online":"Offline"})})}const $=[{type:"dateTimeLocation",title:"Date/Time & Location",icon:e.jsx(Ct,{className:"w-5 h-5"}),component:Bt},{type:"observationType",title:"Type of Observation",icon:e.jsx(kt,{className:"w-5 h-5"}),component:rs},{type:"compassBearing",title:"Compass Bearing",icon:e.jsx(ne,{className:"w-5 h-5"}),component:is},{type:"photo",title:"Photo",icon:e.jsx(pe,{className:"w-5 h-5"}),component:ls}],ms=t=>t?(t instanceof Date?t:new Date(t)).toISOString().split("T")[0]:"",ps=({onSubmit:t,isSubmitting:s})=>{var F;const{currentStep:a,formData:r,goToNextStep:i,goToPreviousStep:o,isStepValid:c,isLastStep:u,resetForm:n}=z(),[x,p]=l.useState(!1),g=Ce(),{user:h}=ke(),m=ge(),f=$.findIndex(N=>N.type===a),[k,j]=l.useState(null),[Q,P]=l.useState(null),R=x||s,B=l.useCallback(async()=>{try{if(p(!0),j(null),P(null),!r.activity_date||!r.activity_time||!r.observation_type){v.error("Please fill in all required fields");return}let N=(h==null?void 0:h.id)||null;if(m&&!N){const{data:{session:M}}=await ft.auth.getSession();M!=null&&M.user&&(N=M.user.id)}const w=ms(r.activity_date),q=r.activity_time||"",V={user_id:N||"",status:"draft",activity_date:new Date(w),activity_time:q,observation_type:r.observation_type,latitude:String(r.latitude||"0"),longitude:String(r.longitude||"0"),is_offline:!m,total_elephants:r.total_elephants?Number(r.total_elephants):void 0,male_elephants:r.male_elephants?Number(r.male_elephants):void 0,female_elephants:r.female_elephants?Number(r.female_elephants):void 0,unknown_elephants:r.unknown_elephants?Number(r.unknown_elephants):void 0,calves:r.calves?Number(r.calves):void 0,compass_bearing:r.compass_bearing?Number(r.compass_bearing):void 0,distance:r.distance!=null?Number(r.distance):void 0,distance_unit:r.distance_unit||void 0,description:r.description||void 0,photo_url:r.photo_url||void 0,indirect_sighting_type:r.indirect_sighting_type,loss_type:r.loss_type};if(!V.observation_type)throw new Error("Observation type is required");if(!V.latitude||!V.longitude)throw new Error("Location is required");if(m)try{await t(V),v.success("Activity report submitted successfully"),n(),g("/")}catch{v.error("Online submission failed. Report saved offline.")}else v.success("You are offline. Report saved locally and will be synced when online."),n(),g("/")}catch(N){console.error("Error submitting activity report:",N),v.error(N.message||"Failed to submit report")}finally{p(!1)}},[r,m,g,t,n,h]),O=((F=$.find(N=>N.type===a))==null?void 0:F.component)||null;return m?e.jsxs("div",{className:"container mx-auto p-2 sm:p-4",children:[e.jsxs(I,{className:"w-full max-w-full sm:max-w-2xl bg-white rounded-xl shadow-sm border border-gray-100 mx-auto",children:[e.jsxs(bt,{className:"space-y-4 sm:space-y-6 p-4 sm:p-6 border-b border-gray-100",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 sm:gap-0",children:[e.jsx(yt,{className:"text-lg sm:text-2xl font-bold text-gray-900",children:"Elephant Watch Report"}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 w-full sm:w-auto",children:[e.jsxs("span",{className:"text-xs sm:text-sm font-medium text-gray-600",children:["Step ",f+1," of ",$.length]}),e.jsx(fe,{value:(f+1)/$.length*100,className:"w-full sm:w-48 h-2 bg-gray-100"})]})]}),e.jsx("div",{className:"flex flex-nowrap overflow-x-auto gap-2 pb-2 sm:pb-0 -mx-2 sm:mx-0 px-2 sm:px-0",children:$.map((N,w)=>e.jsxs(C,{variant:w===f?"default":"outline",size:"sm",className:`flex items-center gap-1 sm:gap-2 px-3 sm:px-4 py-2 rounded-md transition-colors whitespace-nowrap text-xs sm:text-sm
                  ${w===f?"bg-blue-600 hover:bg-blue-700 text-white border-blue-600":"bg-white hover:bg-gray-50 text-gray-600 border-gray-200"}`,disabled:w>f&&!c($[w-1].type),children:[N.icon,N.title]},N.type))})]}),e.jsxs(L,{className:"p-4 sm:p-6",children:[O&&e.jsx(O,{}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between mt-6 sm:mt-8 pt-4 sm:pt-6 border-t border-gray-100 gap-2 sm:gap-0",children:[e.jsx(C,{variant:"outline",onClick:o,disabled:f===0||R,className:"border-gray-200 text-gray-600 hover:bg-gray-50 w-full sm:w-auto",children:"Previous"}),u()?e.jsx(C,{onClick:B,disabled:!c(a)||R,className:"bg-blue-600 hover:bg-blue-700 text-white w-full sm:w-auto",children:R?"Submitting...":"Submit Report"}):e.jsx(C,{onClick:i,disabled:!c(a)||R,className:"bg-blue-600 hover:bg-blue-700 text-white w-full sm:w-auto",children:"Next"})]})]})]}),e.jsx(us,{})]}):e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-red-600 mb-4",children:"No Internet Connection"}),e.jsx("p",{className:"text-gray-600",children:"Please check your internet connection and try again."})]})})},hs=t=>e.jsx(Mt,{children:e.jsx(ps,{...t})}),xs=vt("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),Ke=l.forwardRef(({className:t,variant:s,...a},r)=>e.jsx("div",{ref:r,role:"alert",className:G(xs({variant:s}),t),...a}));Ke.displayName="Alert";const Xe=l.forwardRef(({className:t,...s},a)=>e.jsx("h5",{ref:a,className:G("mb-1 font-medium leading-none tracking-tight",t),...s}));Xe.displayName="AlertTitle";const Je=l.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,className:G("text-sm [&_p]:leading-relaxed",t),...s}));Je.displayName="AlertDescription";const Es=()=>{const[t,s]=l.useState(!1),{user:a,loading:r}=ke(),i=Ce(),o=ge();if(gt.useEffect(()=>{!r&&!a&&i("/login")},[a,r,i]),r)return e.jsx("div",{className:"flex items-center justify-center h-screen",children:"Loading..."});if(!a)return null;const c=async u=>{s(!0);try{const{error:n}=await ae.from("activity_reports").insert([u]);if(n)throw n;v.success("Activity report submitted successfully"),i("/activities")}catch(n){console.error("Error submitting report:",n),v.error("Failed to submit report")}finally{s(!1)}};return e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"container mx-auto p-2 sm:p-4",children:[e.jsxs("header",{className:"mb-8",children:[e.jsx("h1",{className:"text-4xl font-bold tracking-tight text-gray-900 sm:text-5xl",children:"Wild Elephant Monitoring System"}),e.jsx("h2",{className:"mt-2 text-2xl font-semibold text-gray-600",children:"जंगली हाथी निगरानी प्रणाली (2025)"})]}),!o&&e.jsxs(Ke,{className:"mb-4",children:[e.jsx(re,{className:"h-4 w-4"}),e.jsx(Xe,{children:"Offline Mode"}),e.jsx(Je,{children:"You are currently offline. Your report will be saved locally and synced when you are back online."})]}),e.jsx(I,{className:"mb-8 overflow-hidden border border-blue-100 bg-white shadow-sm",children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(re,{className:"h-6 w-6 text-blue-600 flex-shrink-0 mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"निर्देश / Instructions:"}),e.jsxs("ul",{className:"space-y-3 text-gray-600",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-600",children:"•"}),e.jsxs("span",{children:["इस फॉर्म को चार चरणों में पूरा करें: तारीख/समय और स्थान, अवलोकन का प्रकार, कम्पास बेयरिंग, और फोटो।",e.jsx("br",{}),e.jsx("span",{className:"text-gray-500",children:"Complete this form in four steps: Date/Time & Location, Type of Observation, Compass Bearing, and Photo."})]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-600",children:"•"}),e.jsxs("span",{children:["प्रत्येक चरण में आवश्यक जानकारी भरें और 'Next' बटन पर क्लिक करें। पिछले चरण पर जाने के लिए 'Previous' बटन का उपयोग करें।",e.jsx("br",{}),e.jsx("span",{className:"text-gray-500",children:"Fill in the required information in each step and click 'Next'. Use 'Previous' to go back to earlier steps."})]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-600",children:"•"}),e.jsxs("span",{children:["GPS लोकेशन को Degree Decimal फॉर्मेट में भरें (उदाहरण: 23.4536 81.4763)। सटीक स्थान महत्वपूर्ण है।",e.jsx("br",{}),e.jsx("span",{className:"text-gray-500",children:"Enter GPS location in Degree Decimal format (Example: 23.4536 81.4763). Accurate location is crucial."})]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-600",children:"•"}),e.jsxs("span",{children:["अवलोकन के प्रकार के अनुसार, हाथियों की संख्या या अप्रत्यक्ष साक्ष्य का विवरण दें।",e.jsx("br",{}),e.jsx("span",{className:"text-gray-500",children:"Based on observation type, provide elephant count or indirect evidence details."})]})]})]})]})]})})}),e.jsx("main",{className:"max-w-4xl mx-auto",children:e.jsx(hs,{onSubmit:c,isSubmitting:t})})]})})};export{Es as default};
