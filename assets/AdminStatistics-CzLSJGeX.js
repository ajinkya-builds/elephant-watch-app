import{j as s}from"./ui-DUKcQzV-.js";import{i as E,a as i}from"./vendor-C4vCQKbn.js";import{C as a}from"./card-BwavTGuP.js";import{s as c,b as K,j as z}from"./index-SXSbLauc.js";import{R as o,b as L,C as j,X as _,Y as y,T as m,c as S,B as b,a as h,P as k,d as q,e as B}from"./charts-BMxcv32P.js";import"./supabase-BA4zP0Ex.js";const A={total_users:0,active_users:0,daily_active_users:0,total_admins:0,new_users_24h:0,new_users_7d:0,new_users_30d:0,user_growth_rate:0},R={total_records:0,records_24h:0,records_7d:0,records_30d:0,avg_records_per_user:0,most_common_activity:"",activity_distribution:{}},w={errors_24h:0,errors_7d:0,failed_logins_24h:0,failed_logins_7d:0,system_uptime:100,avg_response_time:0};async function P(){try{const[{data:l},{data:d},{data:n},{data:p},{data:x},{data:u},{data:e}]=await Promise.all([c.from("user_statistics").select("*").single(),c.from("activity_statistics").select("*").single(),c.from("system_health").select("*").single(),c.from("user_activity_timeline").select("*"),c.from("record_creation_timeline").select("*"),c.from("resource_utilization").select("*"),c.from("recent_activity").select("*")]);return{userStats:l||A,activityStats:d||R,systemHealth:n||w,userActivityTimeline:p||[],recordCreationTimeline:x||[],resourceUtilization:u||[],recentActivity:e||[]}}catch(l){return console.error("Error fetching admin statistics:",l),{userStats:A,activityStats:R,systemHealth:w,userActivityTimeline:[],recordCreationTimeline:[],resourceUtilization:[],recentActivity:[]}}}function U({className:l,...d}){return s.jsx("div",{className:K("animate-pulse rounded-md bg-muted",l),...d})}const C=["#0088FE","#00C49F","#FFBB28","#FF8042","#8884d8","#82ca9d"];function Q(){E();const[l,d]=i.useState("7d"),[n,p]=i.useState(!1),[x,u]=i.useState(!0),[e,T]=i.useState(null),[$,v]=i.useState(!1),[f,G]=i.useState(null),g=async()=>{try{v(!0);const t=await P();T(t)}catch(t){console.error("Error fetching statistics:",t),z.error("Failed to fetch statistics")}finally{u(!1),v(!1)}};if(i.useEffect(()=>{g()},[]),i.useEffect(()=>{let t;return n&&(t=setInterval(g,6e4)),()=>{t&&clearInterval(t)}},[n]),x)return s.jsxs("div",{className:"container mx-auto p-4",children:[s.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Admin Statistics"}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[...Array(6)].map((t,r)=>s.jsxs(a,{className:"p-4",children:[s.jsx(U,{className:"h-4 w-3/4 mb-2"}),s.jsx(U,{className:"h-8 w-1/2"})]},r))})]});if(f||!e)return s.jsxs("div",{className:"container mx-auto p-4",children:[s.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Admin Statistics"}),s.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:f||"Failed to load statistics"})]});const D=e.userActivityTimeline.map(t=>({hour:t.hour,activity:t.activity_count,users:t.unique_users})),F=e.recordCreationTimeline.map(t=>({day:t.day,records:t.record_count,users:t.unique_users})),H=e.resourceUtilization.map(t=>({hour:t.hour,requests:t.request_count,responseTime:t.avg_response_time,errors:t.error_count})),N=[{name:"Admins",value:e.userStats.total_admins},{name:"Regular Users",value:e.userStats.total_users-e.userStats.total_admins}];return s.jsxs("div",{className:"container mx-auto p-4",children:[s.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Admin Statistics"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-8",children:[s.jsxs(a,{className:"p-4",children:[s.jsx("h2",{className:"text-lg font-semibold mb-2",children:"User Activity"}),s.jsx("div",{className:"h-[200px]",children:s.jsx(o,{width:"100%",height:"100%",children:s.jsxs(L,{data:D,children:[s.jsx(j,{strokeDasharray:"3 3"}),s.jsx(_,{dataKey:"hour"}),s.jsx(y,{}),s.jsx(m,{}),s.jsx(S,{type:"monotone",dataKey:"activity",stroke:"#8884d8"}),s.jsx(S,{type:"monotone",dataKey:"users",stroke:"#82ca9d"})]})})})]}),s.jsxs(a,{className:"p-4",children:[s.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Record Creation"}),s.jsx("div",{className:"h-[200px]",children:s.jsx(o,{width:"100%",height:"100%",children:s.jsxs(b,{data:F,children:[s.jsx(j,{strokeDasharray:"3 3"}),s.jsx(_,{dataKey:"day"}),s.jsx(y,{}),s.jsx(m,{}),s.jsx(h,{dataKey:"records",fill:"#8884d8"}),s.jsx(h,{dataKey:"users",fill:"#82ca9d"})]})})})]}),s.jsxs(a,{className:"p-4",children:[s.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Resource Utilization"}),s.jsx("div",{className:"h-[200px]",children:s.jsx(o,{width:"100%",height:"100%",children:s.jsxs(b,{data:H,children:[s.jsx(j,{strokeDasharray:"3 3"}),s.jsx(_,{dataKey:"hour"}),s.jsx(y,{}),s.jsx(m,{}),s.jsx(h,{dataKey:"requests",fill:"#8884d8"}),s.jsx(h,{dataKey:"errors",fill:"#ff8042"})]})})})]}),s.jsxs(a,{className:"p-4",children:[s.jsx("h2",{className:"text-lg font-semibold mb-2",children:"User Distribution"}),s.jsx("div",{className:"h-[200px]",children:s.jsx(o,{width:"100%",height:"100%",children:s.jsxs(k,{children:[s.jsx(q,{data:N,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,fill:"#8884d8",paddingAngle:5,dataKey:"value",label:({name:t,percent:r})=>`${t} ${(r*100).toFixed(0)}%`,children:N.map((t,r)=>s.jsx(B,{fill:C[r%C.length]},`cell-${r}`))}),s.jsx(m,{})]})})})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs(a,{className:"p-4",children:[s.jsx("h2",{className:"text-lg font-semibold mb-4",children:"User Statistics"}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("p",{children:["Total Users: ",e.userStats.total_users]}),s.jsxs("p",{children:["Active Users: ",e.userStats.active_users]}),s.jsxs("p",{children:["Daily Active Users: ",e.userStats.daily_active_users]}),s.jsxs("p",{children:["Total Admins: ",e.userStats.total_admins]}),s.jsxs("p",{children:["New Users (24h): ",e.userStats.new_users_24h]}),s.jsxs("p",{children:["New Users (7d): ",e.userStats.new_users_7d]}),s.jsxs("p",{children:["New Users (30d): ",e.userStats.new_users_30d]}),s.jsxs("p",{children:["Growth Rate: ",e.userStats.user_growth_rate,"%"]})]})]}),s.jsxs(a,{className:"p-4",children:[s.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Activity Statistics"}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("p",{children:["Total Records: ",e.activityStats.total_records]}),s.jsxs("p",{children:["Records (24h): ",e.activityStats.records_24h]}),s.jsxs("p",{children:["Records (7d): ",e.activityStats.records_7d]}),s.jsxs("p",{children:["Records (30d): ",e.activityStats.records_30d]}),s.jsxs("p",{children:["Avg Records/User: ",e.activityStats.avg_records_per_user]}),s.jsxs("p",{children:["Most Common Activity: ",e.activityStats.most_common_activity]})]})]}),s.jsxs(a,{className:"p-4",children:[s.jsx("h2",{className:"text-lg font-semibold mb-4",children:"System Health"}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("p",{children:["Errors (24h): ",e.systemHealth.errors_24h]}),s.jsxs("p",{children:["Errors (7d): ",e.systemHealth.errors_7d]}),s.jsxs("p",{children:["Failed Logins (24h): ",e.systemHealth.failed_logins_24h]}),s.jsxs("p",{children:["Failed Logins (7d): ",e.systemHealth.failed_logins_7d]}),s.jsxs("p",{children:["System Uptime: ",e.systemHealth.system_uptime,"%"]}),s.jsxs("p",{children:["Avg Response Time: ",e.systemHealth.avg_response_time,"ms"]})]})]})]}),s.jsxs(a,{className:"mt-8 p-4",children:[s.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Recent Activity"}),s.jsx("div",{className:"space-y-4",children:e.recentActivity.map((t,r)=>s.jsx("div",{className:"flex items-start space-x-4",children:s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"font-medium",children:t.event_type}),s.jsx("div",{className:"text-sm text-gray-500",children:t.details}),s.jsxs("div",{className:"text-xs text-gray-400",children:[new Date(t.event_time).toLocaleString()," by ",t.user]})]})},r))})]})]})}export{Q as default};
//# sourceMappingURL=AdminStatistics-CzLSJGeX.js.map
