import{r as l,j as e,X as ee,n as se,L as U,as as ae,ax as re,ay as te,at as ne,az as ie,aA as le,T as S}from"./vendor-BqhWbvy8.js";import{B as p}from"./button-P8oVsJJh.js";import{I as N}from"./input-DeYbvL2d.js";import{L as g}from"./label-CNbkPqMD.js";import{C as oe,b as ce,c as de,a as me}from"./card-igt9_9sz.js";import{l as ue,m as he,n as z,o as xe,p as M,q as V,O as q}from"./radix-DI8ViLIX.js";import{c as i,u as fe,a as pe,b as w,s as j}from"./index-fkTowAiO.js";import{S as A,a as D,b as H,c as L,d as c}from"./select-BDTyeLJb.js";import{T as ge,a as je,b as k,c as y,d as ve,e as C}from"./table-zSlhbm4H.js";const Ne=ue,we=he,P=l.forwardRef(({className:r,...n},o)=>e.jsx(q,{ref:o,className:i("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...n}));P.displayName=q.displayName;const B=l.forwardRef(({className:r,children:n,...o},x)=>e.jsxs(we,{children:[e.jsx(P,{}),e.jsxs(z,{ref:x,className:i("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",r),...o,children:[n,e.jsxs(xe,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(ee,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));B.displayName=z.displayName;const I=({className:r,...n})=>e.jsx("div",{className:i("flex flex-col space-y-1.5 text-center sm:text-left",r),...n});I.displayName="DialogHeader";const $=({className:r,...n})=>e.jsx("div",{className:i("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",r),...n});$.displayName="DialogFooter";const G=l.forwardRef(({className:r,...n},o)=>e.jsx(M,{ref:o,className:i("text-lg font-semibold leading-none tracking-tight",r),...n}));G.displayName=M.displayName;const X=l.forwardRef(({className:r,...n},o)=>e.jsx(V,{ref:o,className:i("text-sm text-muted-foreground",r),...n}));X.displayName=V.displayName;const ye=se("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function O({className:r,variant:n,...o}){return e.jsx("div",{className:i(ye({variant:n}),r),...o})}function Ce(r,n){switch(n.type){case"FETCH_START":return{...r,loading:!0,error:null};case"FETCH_SUCCESS":return{...r,loading:!1,error:null,users:n.payload,lastFetched:Date.now()};case"FETCH_ERROR":return{...r,loading:!1,error:n.error};default:return r}}function De(){const[r,n]=l.useState(""),[o,x]=l.useState(!1),[v,b]=l.useState(!1),[t,u]=l.useState({first_name:"",last_name:"",email:"",role:"viewer",position:"Ranger",password:""}),{user:T}=fe(),{theme:h}=pe(),R=l.useRef(null),[d,f]=l.useReducer(Ce,{users:[],loading:!0,error:null,lastFetched:null}),E=w(h,"bg-background text-onBackground"),J=w(h,"text-onSurface"),K=w(h,"text-onSurfaceVariant");l.useEffect(()=>((async()=>{try{f({type:"FETCH_START"});const{data:a,error:m}=await j.from("users").select("*").order("created_at",{ascending:!1});if(m)throw m;f({type:"FETCH_SUCCESS",payload:a})}catch(a){console.error("Error fetching users:",a),f({type:"FETCH_ERROR",error:a instanceof Error?a.message:"Failed to fetch users"})}})(),()=>{R.current&&R.current.abort()}),[]);const Q=async s=>{if(s.preventDefault(),!!T)try{b(!0);const{data:a,error:m}=await j.auth.signUp({email:t.email,password:t.password,options:{data:{first_name:t.first_name,last_name:t.last_name}}});if(m)throw m;if(!a.user)throw new Error("Failed to create user");const{error:_}=await j.from("users").insert([{auth_id:a.user.id,email:t.email,first_name:t.first_name,last_name:t.last_name,role:t.role,position:t.position,is_active:!0,status:"active",created_by:T.id}]);if(_)throw _;f({type:"FETCH_START"});const{data:Z,error:F}=await j.from("users").select("*").order("created_at",{ascending:!1});if(F)throw F;f({type:"FETCH_SUCCESS",payload:Z}),x(!1),u({first_name:"",last_name:"",email:"",role:"viewer",position:"Ranger",password:""}),S.success("User created successfully")}catch(a){console.error("Error creating user:",a),S.error(a instanceof Error?a.message:"Failed to create user")}finally{b(!1)}},W=async s=>{if(window.confirm(`Are you sure you want to delete ${s.first_name} ${s.last_name}?`))try{b(!0);const{error:a}=await j.auth.admin.deleteUser(s.auth_id);if(a)throw a;const{error:m}=await j.from("users").delete().eq("id",s.id);if(m)throw m;f({type:"FETCH_SUCCESS",payload:d.users.filter(_=>_.id!==s.id)}),S.success("User deleted successfully")}catch(a){console.error("Error deleting user:",a),S.error(a instanceof Error?a.message:"Failed to delete user")}finally{b(!1)}},Y=l.useMemo(()=>{if(!r)return d.users;const s=r.toLowerCase();return d.users.filter(a=>a.first_name.toLowerCase().includes(s)||a.last_name.toLowerCase().includes(s)||a.email.toLowerCase().includes(s)||`${a.first_name} ${a.last_name}`.toLowerCase().includes(s))},[d.users,r]);return d.loading&&d.users.length===0?e.jsx("div",{className:i("flex items-center justify-center min-h-screen",E),children:e.jsx(U,{className:"h-8 w-8 animate-spin"})}):d.error?e.jsx("div",{className:i("p-4",E),children:e.jsxs("div",{className:i("border p-4 rounded-lg",w(h,"bg-errorContainer text-onErrorContainer border-error")),children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ae,{className:"w-5 h-5 mr-2"}),e.jsxs("span",{children:["Error: ",d.error]})]}),e.jsxs(p,{variant:"outline",size:"sm",className:i("mt-2",w(h,"text-onErrorContainer border-onErrorContainer hover:bg-error/10")),onClick:()=>window.location.reload(),children:[e.jsx(re,{className:"mr-2 h-4 w-4"}),"Retry"]})]})}):e.jsxs("div",{className:i("min-h-screen p-6",E),children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:i(h.typography.headlineLarge,J),children:"User Management"}),e.jsx("p",{className:i(h.typography.bodyLarge,K),children:"Manage application users and their permissions"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(te,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(N,{type:"search",placeholder:"Search users...",className:"pl-10 w-64",value:r,onChange:s=>n(s.target.value)})]}),e.jsxs(p,{onClick:()=>x(!0),children:[e.jsx(ne,{className:"mr-2 h-4 w-4"})," Add User"]})]})]}),e.jsxs(oe,{children:[e.jsx(ce,{children:e.jsx(de,{children:"Users"})}),e.jsx(me,{children:e.jsxs(ge,{children:[e.jsx(je,{children:e.jsxs(k,{children:[e.jsx(y,{children:"Name"}),e.jsx(y,{children:"Email"}),e.jsx(y,{children:"Role"}),e.jsx(y,{children:"Status"}),e.jsx(y,{className:"text-right",children:"Actions"})]})}),e.jsx(ve,{children:Y.map(s=>e.jsxs(k,{children:[e.jsxs(C,{className:"font-medium",children:[s.first_name," ",s.last_name]}),e.jsx(C,{children:s.email}),e.jsx(C,{children:e.jsx(O,{variant:"outline",className:"capitalize",children:s.role})}),e.jsx(C,{children:e.jsx(O,{variant:s.status==="active"?"default":"secondary",children:s.status})}),e.jsx(C,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(p,{variant:"ghost",size:"icon",children:e.jsx(ie,{className:"h-4 w-4"})}),e.jsx(p,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive",onClick:()=>W(s),disabled:v,children:e.jsx(le,{className:"h-4 w-4"})})]})})]},s.id))})]})})]})]}),e.jsx(Ne,{open:o,onOpenChange:x,children:e.jsxs(B,{className:"sm:max-w-[500px]",children:[e.jsxs(I,{children:[e.jsx(G,{children:"Add New User"}),e.jsx(X,{children:"Create a new user account. The user will receive an email to set their password."})]}),e.jsxs("form",{onSubmit:Q,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(g,{htmlFor:"first_name",className:"text-right",children:"First Name"}),e.jsx(N,{id:"first_name",className:"col-span-3",value:t.first_name,onChange:s=>u({...t,first_name:s.target.value}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(g,{htmlFor:"last_name",className:"text-right",children:"Last Name"}),e.jsx(N,{id:"last_name",className:"col-span-3",value:t.last_name,onChange:s=>u({...t,last_name:s.target.value}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(g,{htmlFor:"email",className:"text-right",children:"Email"}),e.jsx(N,{id:"email",type:"email",className:"col-span-3",value:t.email,onChange:s=>u({...t,email:s.target.value}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(g,{htmlFor:"password",className:"text-right",children:"Password"}),e.jsx(N,{id:"password",type:"password",className:"col-span-3",value:t.password,onChange:s=>u({...t,password:s.target.value}),required:!0,minLength:6})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(g,{htmlFor:"role",className:"text-right",children:"Role"}),e.jsxs(A,{value:t.role,onValueChange:s=>u({...t,role:s}),children:[e.jsx(D,{className:"col-span-3",children:e.jsx(H,{placeholder:"Select a role"})}),e.jsxs(L,{children:[e.jsx(c,{value:"admin",children:"Admin"}),e.jsx(c,{value:"manager",children:"Manager"}),e.jsx(c,{value:"data_collector",children:"Data Collector"}),e.jsx(c,{value:"viewer",children:"Viewer"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(g,{htmlFor:"position",className:"text-right",children:"Position"}),e.jsxs(A,{value:t.position,onValueChange:s=>u({...t,position:s}),children:[e.jsx(D,{className:"col-span-3",children:e.jsx(H,{placeholder:"Select a position"})}),e.jsxs(L,{children:[e.jsx(c,{value:"Admin",children:"Admin"}),e.jsx(c,{value:"Manager",children:"Manager"}),e.jsx(c,{value:"DFO",children:"DFO"}),e.jsx(c,{value:"Officer",children:"Officer"}),e.jsx(c,{value:"Ranger",children:"Ranger"}),e.jsx(c,{value:"Guard",children:"Guard"})]})]})]})]}),e.jsxs($,{children:[e.jsx(p,{type:"button",variant:"outline",onClick:()=>x(!1),disabled:v,children:"Cancel"}),e.jsxs(p,{type:"submit",disabled:v,children:[v&&e.jsx(U,{className:"mr-2 h-4 w-4 animate-spin"}),v?"Creating...":"Create User"]})]})]})]})})]})}export{De as default};
//# sourceMappingURL=AdminUsers-URMmLtJB.js.map
